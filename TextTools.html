<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TextToolsã€Šï¾ƒï½·ï½½ï¾„ï¾‚ï½°ï¾™ï½½ï¾ã€‹- ãƒ†ã‚­ã‚¹ãƒˆå‡¦ç†ãƒ„ãƒ¼ãƒ«é›†</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/encoding-japanese/2.0.0/encoding.min.js"></script>

<link id="favicon" rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NCA2NCI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9InRleHRHcmFkIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzAwNzdjYyIvPgogICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiMwMGZmY2MiLz4KICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgPC9kZWZzPgogIDxyZWN0IHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgcng9IjEyIiBmaWxsPSIjZjVmNWY3Ii8+CiAgPHRleHQgeD0iMzIiIHk9IjQ2IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIgogICAgICAgIGZvbnQtZmFtaWx5PSJCYWhuc2NocmlmdCwgJ1NlZ29lIFVJJywgc2Fucy1zZXJpZiIKICAgICAgICBmb250LXNpemU9IjM2IiBmb250LXdlaWdodD0iNTAwIgogICAgICAgIGZpbGw9InVybCgjdGV4dEdyYWQpIj5UVDwvdGV4dD4KPC9zdmc+Cg==">

<style>
:root {
  --bg: #f5f5f7;
  --surface: #ffffff;
  --surface-raised: #f0f0f2;
  --border: #d0d0d8;
  --text: #1a1a2e;
  --text-muted: #666680;
  --accent: #0077cc;
  --accent-glow: rgba(0, 119, 204, 0.1);
  --delete: #d63031;
  --delete-bg: rgba(214, 48, 49, 0.12);
  --insert: #00a86b;
  --insert-bg: rgba(0, 168, 107, 0.12);
  --change: #e67e22;
  --change-bg: rgba(230, 126, 34, 0.12);
  --grid-color: rgba(0, 119, 204, 0.05);
}

[data-theme="dark"] {
  --bg: #0a0a0f;
  --surface: #12121a;
  --surface-raised: #1a1a26;
  --border: #2a2a3a;
  --text: #e8e8f0;
  --text-muted: #8888a0;
  --accent: #00d4ff;
  --accent-glow: rgba(0, 212, 255, 0.15);
  --delete: #ff6b8a;
  --delete-bg: rgba(255, 107, 138, 0.15);
  --insert: #7dffb3;
  --insert-bg: rgba(125, 255, 179, 0.15);
  --change: #ffcc4d;
  --change-bg: rgba(255, 204, 77, 0.15);
  --grid-color: rgba(0, 212, 255, 0.03);
}

[data-theme="sepia"] {
  --bg: #f4ecd8;
  --surface: #faf6eb;
  --surface-raised: #efe9d9;
  --border: #d4c9a8;
  --text: #433422;
  --text-muted: #7a6a50;
  --accent: #8b4513;
  --accent-glow: rgba(139, 69, 19, 0.1);
  --delete: #a0522d;
  --delete-bg: rgba(160, 82, 45, 0.15);
  --insert: #228b22;
  --insert-bg: rgba(34, 139, 34, 0.15);
  --change: #b8860b;
  --change-bg: rgba(184, 134, 11, 0.15);
  --grid-color: rgba(139, 69, 19, 0.04);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  line-height: 1.6;
}

body::before {
  content: '';
  position: fixed;
  inset: 0;
  background-image: 
    linear-gradient(var(--grid-color) 1px, transparent 1px),
    linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
  background-size: 50px 50px;
  pointer-events: none;
  z-index: -1;
}

.container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 24px;
}

header {
  text-align: center;
  margin-bottom: 24px;
  animation: fadeInDown 0.6s ease-out;
}

@keyframes fadeInDown {
  from { opacity: 0; transform: translateY(-20px); }
  to { opacity: 1; transform: translateY(0); }
}

h1 {
  font-size: 1.8rem;
  font-weight: 700;
  letter-spacing: -0.02em;
  margin-bottom: 8px;
}

h1 span.tool-name {
  background: linear-gradient(135deg, var(--accent), #00ffcc);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

h1 span.katakana {
  font-size: 1rem;
  color: var(--text-muted);
  -webkit-text-fill-color: var(--text-muted);
  margin-left: 8px;
  font-weight: 400;
}

.tagline {
  color: var(--text-muted);
  font-size: 0.9rem;
}

/* Theme selector */
.theme-selector {
  display: flex;
  justify-content: center;
  gap: 8px;
  margin-bottom: 24px;
}

.theme-btn {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  border: 2px solid var(--border);
  cursor: pointer;
  transition: all 0.2s;
  padding: 0;
}

.theme-btn:hover { transform: scale(1.1); }
.theme-btn.active {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-glow);
}

.theme-btn.dark { background: #0a0a0f; }
.theme-btn.light { background: #f5f5f7; }
.theme-btn.sepia { background: #f4ecd8; }

/* Tool selector tabs */
.tool-tabs {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 24px;
  justify-content: center;
  animation: fadeIn 0.6s ease-out 0.1s both;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.tool-tab {
  padding: 10px 18px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px;
  cursor: pointer;
  font-size: 0.85rem;
  font-weight: 500;
  color: var(--text-muted);
  transition: all 0.2s;
}

.tool-tab:hover {
  border-color: var(--accent);
  color: var(--text);
}

.tool-tab.active {
  background: var(--accent);
  color: var(--bg);
  border-color: var(--accent);
  box-shadow: 0 4px 15px var(--accent-glow);
}

/* Main layout */
.main-content {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
  animation: fadeIn 0.6s ease-out 0.2s both;
}

.main-content.full-width {
  grid-template-columns: 1fr;
}

@media (max-width: 900px) {
  .main-content {
    grid-template-columns: 1fr;
  }
}

/* Panels */
.panel {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  overflow: hidden;
}

.panel-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
  background: var(--surface-raised);
  border-bottom: 1px solid var(--border);
}

.panel-title {
  font-size: 0.8rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--text-muted);
  display: flex;
  align-items: center;
  gap: 8px;
}

.panel-title::before {
  content: '';
  display: inline-block;
  width: 8px;
  height: 8px;
  border-radius: 2px;
  background: var(--accent);
}

.output-panel .panel-title::before {
  background: linear-gradient(135deg, #00ffcc, #00d4ff);
}

.panel-actions {
  display: flex;
  gap: 6px;
}

.panel-body {
  padding: 16px;
}

textarea {
  width: 100%;
  min-height: 300px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 12px;
  font-family: 'SF Mono', Consolas, monospace;
  font-size: 0.9rem;
  color: var(--text);
  resize: vertical;
  transition: border-color 0.2s, box-shadow 0.2s;
}

textarea:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-glow);
}

textarea::placeholder {
  color: var(--text-muted);
  opacity: 0.6;
}

/* ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ— */
.panel.drag-over {
  border: 2px dashed var(--accent);
  background: var(--accent-glow);
}

.panel.drag-over textarea {
  pointer-events: none;
}

/* Buttons */
button {
  font-family: inherit;
  font-size: 0.8rem;
  font-weight: 500;
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-small {
  padding: 4px 10px;
  font-size: 0.75rem;
}

.btn-primary {
  background: var(--accent);
  color: var(--bg);
  border: none;
  box-shadow: 0 2px 10px var(--accent-glow);
}

.btn-primary:hover {
  transform: translateY(-1px);
  filter: brightness(1.1);
}

.btn-secondary {
  background: transparent;
  color: var(--text-muted);
  border: 1px solid var(--border);
}

.btn-secondary:hover {
  border-color: var(--accent);
  color: var(--text);
}

/* Tool options */
.tool-options {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 24px;
  animation: fadeIn 0.6s ease-out 0.15s both;
}

.tool-options-title {
  font-size: 0.9rem;
  font-weight: 600;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.tool-options-title::before {
  content: 'âš™';
}

.option-row {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 12px;
  flex-wrap: wrap;
}

.option-row:last-child {
  margin-bottom: 0;
}

.option-section {
  background: var(--surface-raised);
  border-radius: 8px;
  padding: 12px;
  margin-bottom: 12px;
}

.option-section:last-child {
  margin-bottom: 0;
}

.option-section-title {
  font-size: 0.85rem;
  font-weight: 600;
  color: var(--text);
  margin-bottom: 10px;
}

/* Combination Generator Styles */
.combination-inputs {
  display: flex;
  gap: 8px;
  overflow-x: auto;
  padding: 12px 0;
  align-items: flex-start;
}

.combo-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  flex-shrink: 0;
}

.combo-label {
  font-size: 0.75rem;
  color: var(--text-muted);
  margin-bottom: 6px;
  font-weight: 500;
}

.combo-field {
  width: 80px;
  padding: 8px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 6px;
  font-size: 0.85rem;
  color: var(--text);
  text-align: center;
}

.combo-field:focus {
  outline: none;
  border-color: var(--accent);
}

.combo-textarea {
  width: 150px;
  height: 150px;
  padding: 8px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 6px;
  font-family: monospace;
  font-size: 0.8rem;
  color: var(--text);
  resize: vertical;
}

.combo-textarea:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 2px var(--accent-glow);
}

.combo-count {
  font-size: 0.7rem;
  color: var(--text-muted);
  margin-top: 4px;
}

.combo-delim {
  align-self: center;
  margin-top: 20px;
}

.combo-delim .combo-field {
  width: 60px;
}

.combo-prefix, .combo-suffix {
  align-self: center;
  margin-top: 20px;
}

.combo-add {
  align-self: center;
  margin-top: 20px;
}

.combo-actions {
  display: flex;
  align-items: center;
  gap: 16px;
  margin-top: 12px;
  padding-top: 12px;
  border-top: 1px solid var(--border);
}

/* Count Table Styles */
.count-table {
  overflow-x: auto;
}

.count-table table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.85rem;
}

.count-table th, .count-table td {
  padding: 12px 16px;
  text-align: left;
  border: 1px solid var(--border);
}

.count-table th {
  background: var(--bg);
  font-weight: 600;
  color: var(--text);
  text-align: center;
}

.count-table td:nth-child(odd) {
  background: var(--bg);
  font-weight: 500;
  color: var(--text-muted);
  width: 100px;
}

.count-table td:nth-child(even) {
  text-align: right;
  color: var(--text);
}

.count-table td:nth-child(even) strong {
  font-size: 1.1rem;
  color: var(--accent);
}

/* Word Frequency Table */
.word-freq-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.8rem;
}

.word-freq-table th, .word-freq-table td {
  padding: 6px 10px;
  text-align: left;
  border-bottom: 1px solid var(--border);
}

.word-freq-table th {
  background: var(--bg);
  font-weight: 600;
  position: sticky;
  top: 0;
}

.word-freq-table td:nth-child(2),
.word-freq-table td:nth-child(3) {
  text-align: right;
}

/* Column Extract Results */
.column-results-container {
  margin-top: 15px;
  overflow-x: auto;
}

.column-results-container table {
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed;
}

.column-results-container th {
  background: var(--bg);
  padding: 10px;
  border: 1px solid var(--border);
  font-weight: 600;
  font-size: 0.85rem;
}

.column-results-container td {
  padding: 0;
  border: 1px solid var(--border);
  vertical-align: top;
}

.column-results-container textarea {
  width: 100%;
  height: 200px;
  border: none;
  padding: 8px;
  font-family: monospace;
  font-size: 0.85rem;
  resize: vertical;
  background: var(--surface);
  color: var(--text);
}

.column-results-container .col-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.column-results-container .btn-copy-col {
  padding: 2px 8px;
  font-size: 0.7rem;
  background: var(--accent);
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.column-results-container .btn-copy-col:hover {
  background: var(--accent-hover);
}

.option-row label {
  font-size: 0.85rem;
  color: var(--text);
  min-width: 120px;
}

.option-row input[type="text"],
.option-row select {
  flex: 1;
  min-width: 150px;
  max-width: 300px;
  padding: 8px 12px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 6px;
  font-size: 0.85rem;
  color: var(--text);
}

.option-row input[type="text"]:focus,
.option-row select:focus {
  outline: none;
  border-color: var(--accent);
}

.option-row input[type="checkbox"] {
  width: 18px;
  height: 18px;
  cursor: pointer;
}

.option-row input[type="number"] {
  width: 80px;
  padding: 8px 12px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 6px;
  font-size: 0.85rem;
  color: var(--text);
}

/* Execute button */
.execute-section {
  display: flex;
  justify-content: center;
  gap: 12px;
  margin-bottom: 24px;
}

.btn-execute {
  padding: 12px 32px;
  font-size: 1rem;
  font-weight: 600;
}

/* Stats bar */
.stats-bar {
  display: flex;
  gap: 16px;
  padding: 12px 16px;
  background: var(--surface-raised);
  border-top: 1px solid var(--border);
  font-size: 0.8rem;
  flex-wrap: wrap;
}

.stat-item {
  display: flex;
  align-items: center;
  gap: 6px;
}

.stat-label {
  color: var(--text-muted);
}

.stat-value {
  font-weight: 600;
  color: var(--text);
  font-variant-numeric: tabular-nums;
}

/* Footer */
footer {
  margin-top: 32px;
  text-align: center;
  color: var(--text-muted);
  font-size: 0.75rem;
  padding-top: 16px;
  border-top: 1px solid var(--border);
}

/* Hidden tool panels */
.tool-panel {
  display: none;
}

.tool-panel.active {
  display: block;
}
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>
      <span class="tool-name">TextTools</span>
      <span class="katakana">ã€Šï¾ƒï½·ï½½ï¾„ï¾‚ï½°ï¾™ï½½ï¾ã€‹</span>
    </h1>
    <p class="tagline">ãƒ†ã‚­ã‚¹ãƒˆå‡¦ç†ã«ä¾¿åˆ©ãªãƒ„ãƒ¼ãƒ«é›†</p>
  </header>

  <div class="theme-selector">
    <button class="theme-btn dark" onclick="setTheme('dark')" title="ãƒ€ãƒ¼ã‚¯"></button>
    <button class="theme-btn light active" onclick="setTheme('light')" title="ãƒ©ã‚¤ãƒˆ"></button>
    <button class="theme-btn sepia" onclick="setTheme('sepia')" title="ã‚»ãƒ”ã‚¢"></button>
  </div>

  <div class="tool-tabs">
    <button class="tool-tab active" data-tool="prefix-suffix">è¡Œé ­/è¡Œæœ«è¿½åŠ </button>
    <button class="tool-tab" data-tool="line-breaks">æ”¹è¡Œè¿½åŠ /å‰Šé™¤</button>
    <button class="tool-tab" data-tool="count">æ–‡å­—ã‚«ã‚¦ãƒ³ãƒˆ</button>
    <button class="tool-tab" data-tool="column-extract">åˆ—æŠ½å‡º</button>
    <button class="tool-tab" data-tool="find-replace">æ¤œç´¢ã¨ç½®æ›</button>
    <button class="tool-tab" data-tool="combination">çµ„ã¿åˆã‚ã›ç”Ÿæˆ</button>
    <button class="tool-tab" data-tool="remove-spaces">ç©ºç™½å‰Šé™¤</button>
    <button class="tool-tab" data-tool="add-spaces">ç©ºç™½è¿½åŠ </button>
    <button class="tool-tab" data-tool="convert">æ–‡å­—å¤‰æ›</button>
    <button class="tool-tab" data-tool="line-ops">è¡Œæ“ä½œ</button>
  </div>

  <!-- Prefix/Suffix Tool -->
  <div class="tool-panel active" id="panel-prefix-suffix">
    <div class="tool-options">
      <div class="tool-options-title">è¡Œé ­/è¡Œæœ«è¿½åŠ ã‚ªãƒ—ã‚·ãƒ§ãƒ³</div>
      <div class="option-row">
        <label>è¡Œé ­ã«è¿½åŠ :</label>
        <input type="text" id="prefix-text" placeholder="ä¾‹: - ">
      </div>
      <div class="option-row">
        <label>è¡Œæœ«ã«è¿½åŠ :</label>
        <input type="text" id="suffix-text" placeholder="ä¾‹: ,">
      </div>
      <div class="option-row">
        <label>
          <input type="checkbox" id="prefix-skip-empty"> ç©ºè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—
        </label>
      </div>
    </div>
  </div>

  <!-- Line Breaks Tool -->
  <div class="tool-panel" id="panel-line-breaks">
    <div class="tool-options">
      <div class="tool-options-title">æ”¹è¡Œè¿½åŠ /å‰Šé™¤ã‚ªãƒ—ã‚·ãƒ§ãƒ³</div>
      
      <div class="option-section">
        <div class="option-section-title">â–  ã™ã¹ã¦ã®æ”¹è¡Œã‚’å‰Šé™¤</div>
        <div class="option-row">
          <label>ç½®æ›æ–‡å­—åˆ—:</label>
          <input type="text" id="lb-remove-replace" placeholder="ç©ºæ¬„ã§å˜ç´”å‰Šé™¤" style="max-width:200px;">
          <button class="btn-primary btn-small" onclick="executeLineBreakRemoveAll()">å®Ÿè¡Œ</button>
        </div>
      </div>

      <div class="option-section">
        <div class="option-section-title">â–  æŒ‡å®šæ–‡å­—åˆ—ã®å‰å¾Œã«æ”¹è¡Œã‚’è¿½åŠ </div>
        <div class="option-row">
          <label>å¯¾è±¡æ–‡å­—åˆ—:</label>
          <input type="text" id="lb-target-text" placeholder="ã“ã®æ–‡å­—åˆ—ã®å‰å¾Œã«æ”¹è¡Œ" style="max-width:200px;">
        </div>
        <div class="option-row">
          <label>
            <input type="radio" name="lb-position" value="after" checked> å¾Œã«è¿½åŠ 
          </label>
          <label>
            <input type="radio" name="lb-position" value="before"> å‰ã«è¿½åŠ 
          </label>
        </div>
        <div class="option-row">
          <label>
            <input type="checkbox" id="lb-case-sensitive"> å¤§æ–‡å­—å°æ–‡å­—ã‚’åŒºåˆ¥
          </label>
          <label>
            <input type="checkbox" id="lb-remove-existing"> æ—¢å­˜ã®æ”¹è¡Œã‚’å‰Šé™¤
          </label>
          <button class="btn-primary btn-small" onclick="executeLineBreakAtText()">å®Ÿè¡Œ</button>
        </div>
      </div>

      <div class="option-section">
        <div class="option-section-title">â–  Næ–‡å­—ã”ã¨ã«æ”¹è¡Œ</div>
        <div class="option-row">
          <label>æ–‡å­—æ•°:</label>
          <input type="number" id="lb-every-n" value="80" min="1" style="width:80px;">
        </div>
        <div class="option-row">
          <label>
            <input type="checkbox" id="lb-wordwrap"> å˜èªã®é€”ä¸­ã§åˆ‡ã‚‰ãªã„
          </label>
          <label>
            <input type="checkbox" id="lb-escape-existing"> æ—¢å­˜ã®æ”¹è¡Œã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ï¼ˆ\nã«å¤‰æ›ï¼‰
          </label>
        </div>
        <div class="option-row">
          <button class="btn-primary btn-small" onclick="executeLineBreakEveryN()">å®Ÿè¡Œ</button>
        </div>
      </div>

      <div class="option-section">
        <div class="option-section-title">â–  ãã®ä»–ã®æ”¹è¡Œæ“ä½œ</div>
        <div class="option-row">
          <button class="btn-primary btn-small" onclick="executeLineBreakAddAfterEach()">å„è¡Œã®å¾Œã«ç©ºè¡Œè¿½åŠ </button>
          <button class="btn-primary btn-small" onclick="executeLineBreakAddBeforeEach()">å„è¡Œã®å‰ã«ç©ºè¡Œè¿½åŠ </button>
          <button class="btn-primary btn-small" onclick="executeLineBreakMergeMultiple()">é€£ç¶šç©ºè¡Œã‚’1ã¤ã«</button>
        </div>
      </div>

    </div>
  </div>

  <!-- Count Tool -->
  <div class="tool-panel" id="panel-count">
    <div class="tool-options">
      <div class="tool-options-title">æ–‡å­—ã‚«ã‚¦ãƒ³ãƒˆ</div>
      
      <div class="option-section">
        <div class="count-table">
          <table>
            <tbody>
              <tr>
                <td>æ–‡å­—æ•°</td>
                <td id="count-chars"><strong>0</strong> æ–‡å­—</td>
                <td>æ”¹è¡Œé™¤ã</td>
                <td id="count-chars-no-newline"><strong>0</strong> æ–‡å­—</td>
                <td>æ”¹è¡Œãƒ»ç©ºç™½é™¤ã</td>
                <td id="count-chars-no-space"><strong>0</strong> æ–‡å­—</td>
              </tr>
              <tr>
                <td>è¡Œæ•°</td>
                <td id="count-lines"><strong>0</strong> è¡Œ</td>
                <td>åŸç¨¿ç”¨ç´™</td>
                <td id="count-genko"><strong>0</strong> æš</td>
                <td>ç•°ä½“å­—</td>
                <td id="count-variant"><strong>0</strong> æ–‡å­—</td>
              </tr>
              <tr>
                <td>UTF-8</td>
                <td id="count-utf8"><strong>0</strong> ãƒã‚¤ãƒˆ</td>
                <td>UTF-16</td>
                <td id="count-utf16"><strong>0</strong> ãƒã‚¤ãƒˆ</td>
                <td>Shift-JIS</td>
                <td id="count-sjis"><strong>0</strong> ãƒã‚¤ãƒˆ</td>
              </tr>
              <tr>
                <td>EUC-JP</td>
                <td id="count-eucjp"><strong>0</strong> ãƒã‚¤ãƒˆ</td>
                <td>JIS</td>
                <td id="count-jis"><strong>0</strong> ãƒã‚¤ãƒˆ</td>
                <td></td>
                <td></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="option-section">
        <div class="option-section-title">â–  æ–‡å­—ç¨®åˆ¥ã‚«ã‚¦ãƒ³ãƒˆ</div>
        <div class="count-table">
          <table>
            <thead>
              <tr>
                <th>ã²ã‚‰ãŒãª</th>
                <th>ã‚«ã‚¿ã‚«ãƒŠ</th>
                <th>æ¼¢å­—</th>
                <th>è‹±å­—</th>
                <th>æ•°å­—</th>
                <th>è¨˜å·</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td id="count-hiragana">0</td>
                <td id="count-katakana">0</td>
                <td id="count-kanji">0</td>
                <td id="count-alpha">0</td>
                <td id="count-digit">0</td>
                <td id="count-symbol">0</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="option-section">
        <div class="option-section-title">â–  è©³ç´°ã‚«ã‚¦ãƒ³ãƒˆ</div>
        <div class="count-table">
          <table>
            <thead>
              <tr>
                <th>å˜èªæ•°</th>
                <th>æ–‡æ•°</th>
                <th>æ®µè½æ•°</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td id="count-words">0</td>
                <td id="count-sentences">0</td>
                <td id="count-paragraphs">0</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="option-section">
        <div class="option-section-title">â–  ã‚«ã‚¦ãƒ³ãƒˆã‚ªãƒ—ã‚·ãƒ§ãƒ³</div>
        <div class="option-row">
          <label>
            <input type="checkbox" id="count-no-spaces"> ã‚¹ãƒšãƒ¼ã‚¹ã‚’é™¤å¤–
          </label>
          <label>
            <input type="checkbox" id="count-no-html"> HTMLã‚¿ã‚°ã‚’é™¤å¤–
          </label>
          <label>
            <input type="checkbox" id="count-linebreak-space"> æ”¹è¡Œã‚’ã‚¹ãƒšãƒ¼ã‚¹ã¨ã—ã¦ã‚«ã‚¦ãƒ³ãƒˆ
          </label>
          <label>
            <input type="checkbox" id="count-realtime" checked> ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
          </label>
        </div>
      </div>

      <div class="option-section">
        <div class="option-section-title">â–  ã‚«ã‚¹ã‚¿ãƒ ã‚«ã‚¦ãƒ³ãƒˆï¼ˆç‰¹å®šæ–‡å­—åˆ—ã®å‡ºç¾å›æ•°ï¼‰</div>
        <div class="option-row">
          <input type="text" id="count-custom-query" placeholder="æ¤œç´¢ã™ã‚‹æ–‡å­—åˆ—" style="max-width:200px;">
          <label>
            <input type="checkbox" id="count-custom-case"> å¤§æ–‡å­—å°æ–‡å­—ã‚’åŒºåˆ¥
          </label>
          <span id="count-custom-result" style="font-weight:600; color:var(--accent); margin-left:10px;"></span>
        </div>
      </div>

      <div class="option-section">
        <div class="option-section-title">â–  å˜èªé »åº¦åˆ†æ</div>
        <div class="option-row">
          <button class="btn-primary btn-small" onclick="showWordFrequency()">å˜èªé »åº¦ã‚’åˆ†æ</button>
          <button class="btn-secondary btn-small" onclick="showCharFrequency()">æ–‡å­—é »åº¦ã‚’åˆ†æ</button>
        </div>
        <div id="word-frequency-result" style="max-height:200px; overflow-y:auto; margin-top:10px; display:none;">
        </div>
      </div>
    </div>
  </div>

  <!-- Column Extract Tool -->
  <div class="tool-panel" id="panel-column-extract">
    <div class="tool-options">
      <div class="tool-options-title">åˆ—æŠ½å‡ºã‚ªãƒ—ã‚·ãƒ§ãƒ³</div>
      
      <div class="option-section">
        <div class="option-row">
          <label>åˆ—ã®åŒºåˆ‡ã‚Šæ–‡å­—:</label>
          <input type="text" id="column-delimiter-text" value="," style="max-width:100px;">
          <label>æŠ½å‡ºã™ã‚‹åˆ—æ•°:</label>
          <input type="number" id="column-count" value="4" min="1" max="20" style="max-width:80px;">
        </div>
        <div class="option-row">
          <label>è¡Œã®åŒºåˆ‡ã‚Šæ–‡å­—:</label>
          <input type="text" id="column-row-delimiter" value="\n" style="max-width:100px;">
        </div>
        <div class="option-row">
          <label>
            <input type="checkbox" id="column-remove-col-delim"> åˆ—ã®åŒºåˆ‡ã‚Šæ–‡å­—ã‚’å‡ºåŠ›ã‹ã‚‰å‰Šé™¤
          </label>
          <label>
            <input type="checkbox" id="column-remove-row-delim"> è¡Œã®åŒºåˆ‡ã‚Šæ–‡å­—ã‚’å‡ºåŠ›ã‹ã‚‰å‰Šé™¤
          </label>
        </div>
        <div class="option-row">
          <label>
            <input type="checkbox" id="column-has-title"> 1åˆ—ç›®ã«ã‚¿ã‚¤ãƒˆãƒ«ãŒã‚ã‚‹ï¼ˆåŒºåˆ‡ã‚Šæ–‡å­—:
          </label>
          <input type="text" id="column-title-delimiter" value=":" style="max-width:60px;">
          <span>ï¼‰</span>
        </div>
        <div class="option-row">
          <label>
            <input type="checkbox" id="column-remove-empty"> ç©ºè¡Œã‚’å‰Šé™¤
          </label>
          <label>
            <input type="checkbox" id="column-trim"> å„å€¤ã®å‰å¾Œã®ç©ºç™½ã‚’å‰Šé™¤
          </label>
        </div>
        <div class="option-row">
          <button class="btn-primary btn-small" onclick="executeColumnExtractMulti()">åˆ—ã‚’æŠ½å‡º</button>
        </div>
      </div>
      
      <div id="column-results" class="column-results-container" style="display:none;">
        <!-- å‹•çš„ã«åˆ—ãŒè¿½åŠ ã•ã‚Œã‚‹ -->
      </div>
    </div>
  </div>

  <!-- Find Replace Tool -->
  <div class="tool-panel" id="panel-find-replace">
    <div class="tool-options">
      <div class="tool-options-title">æ¤œç´¢ã¨ç½®æ›ã‚ªãƒ—ã‚·ãƒ§ãƒ³</div>
      <div class="option-row">
        <label>æ¤œç´¢æ–‡å­—åˆ—:</label>
        <input type="text" id="find-text" placeholder="æ¤œç´¢ã™ã‚‹æ–‡å­—åˆ—">
      </div>
      <div class="option-row">
        <label>ç½®æ›æ–‡å­—åˆ—:</label>
        <input type="text" id="replace-text" placeholder="ç½®æ›å¾Œã®æ–‡å­—åˆ—">
      </div>
      <div class="option-row">
        <label>
          <input type="checkbox" id="find-regex"> æ­£è¦è¡¨ç¾ã‚’ä½¿ç”¨
        </label>
        <label>
          <input type="checkbox" id="find-case"> å¤§æ–‡å­—å°æ–‡å­—ã‚’åŒºåˆ¥
        </label>
      </div>
    </div>
  </div>

  <!-- Line Combine Tool -->
  <!-- Combination Generator Tool -->
  <div class="tool-panel" id="panel-combination">
    <div class="tool-options">
      <div class="tool-options-title">çµ„ã¿åˆã‚ã›ç”Ÿæˆ</div>
      <p style="font-size:0.8rem; color:var(--text-muted); margin-bottom:12px;">
        è¤‡æ•°ã®ãƒªã‚¹ãƒˆã‹ã‚‰ã™ã¹ã¦ã®çµ„ã¿åˆã‚ã›ã‚’ç”Ÿæˆã—ã¾ã™ã€‚ã€Œãƒªã‚¹ãƒˆè¿½åŠ ã€ãƒœã‚¿ãƒ³ã§ãƒªã‚¹ãƒˆã‚’å¢—ã‚„ã›ã¾ã™ã€‚
      </p>
      
      <div class="combination-inputs" id="combinationInputs">
        <!-- Prefix -->
        <div class="combo-item combo-prefix">
          <div class="combo-label">Prefix</div>
          <input type="text" id="combo-prefix" class="combo-field" placeholder="">
        </div>
        
        <!-- List 1 -->
        <div class="combo-item combo-list" data-index="0">
          <div class="combo-label">ãƒªã‚¹ãƒˆ 1</div>
          <textarea class="combo-textarea" id="combo-list-0" placeholder="å„è¡Œã«1é …ç›®"></textarea>
          <div class="combo-count"><span id="combo-count-0">0</span> è¡Œ</div>
        </div>
        
        <!-- Delimiter 1 -->
        <div class="combo-item combo-delim" data-index="0">
          <div class="combo-label">åŒºåˆ‡ã‚Š</div>
          <input type="text" class="combo-field combo-delim-field" id="combo-delim-0" placeholder="">
        </div>
        
        <!-- List 2 -->
        <div class="combo-item combo-list" data-index="1">
          <div class="combo-label">ãƒªã‚¹ãƒˆ 2</div>
          <textarea class="combo-textarea" id="combo-list-1" placeholder="å„è¡Œã«1é …ç›®"></textarea>
          <div class="combo-count"><span id="combo-count-1">0</span> è¡Œ</div>
        </div>
        
        <!-- Delimiter 2 -->
        <div class="combo-item combo-delim" data-index="1">
          <div class="combo-label">åŒºåˆ‡ã‚Š</div>
          <input type="text" class="combo-field combo-delim-field" id="combo-delim-1" placeholder="">
        </div>
        
        <!-- List 3 -->
        <div class="combo-item combo-list" data-index="2">
          <div class="combo-label">ãƒªã‚¹ãƒˆ 3</div>
          <textarea class="combo-textarea" id="combo-list-2" placeholder="å„è¡Œã«1é …ç›®"></textarea>
          <div class="combo-count"><span id="combo-count-2">0</span> è¡Œ</div>
        </div>
        
        <!-- Suffix -->
        <div class="combo-item combo-suffix">
          <div class="combo-label">Suffix</div>
          <input type="text" id="combo-suffix" class="combo-field" placeholder="">
        </div>
        
        <!-- Add button -->
        <div class="combo-item combo-add">
          <button class="btn-secondary btn-small" onclick="addComboList()">+ ãƒªã‚¹ãƒˆè¿½åŠ </button>
        </div>
      </div>
      
      <div class="combo-actions">
        <span id="combination-count" style="font-size:0.85rem; color:var(--accent); font-weight:600;"></span>
        <button class="btn-secondary btn-small" onclick="clearComboInputs()">å…¥åŠ›ã‚¯ãƒªã‚¢</button>
      </div>
    </div>
  </div>

  <!-- Remove Duplicates Tool -->
  <!-- Remove Empty Lines Tool -->
  <!-- Remove/Add Spaces Tool -->
  <!-- Remove Spaces Tool -->
  <div class="tool-panel" id="panel-remove-spaces">
    <div class="tool-options">
      <div class="tool-options-title">ç©ºç™½å‰Šé™¤ã‚ªãƒ—ã‚·ãƒ§ãƒ³</div>
      
      <div class="option-section">
        <div class="option-row">
          <label>
            <input type="checkbox" id="spaces-trim" checked> è¡Œé ­/è¡Œæœ«ã®ç©ºç™½ã‚’å‰Šé™¤ï¼ˆãƒˆãƒªãƒ ï¼‰
          </label>
        </div>
        <div class="option-row">
          <label>
            <input type="radio" name="spaces-remove-mode" value="extra" checked> é€£ç¶šã™ã‚‹ç©ºç™½ã‚’1ã¤ã«
          </label>
          <label>
            <input type="radio" name="spaces-remove-mode" value="all"> ã™ã¹ã¦ã®ç©ºç™½ã‚’å‰Šé™¤
          </label>
          <label>
            <input type="radio" name="spaces-remove-mode" value="none"> å‰Šé™¤ã—ãªã„ï¼ˆãƒˆãƒªãƒ ã®ã¿ï¼‰
          </label>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Spaces Tool -->
  <div class="tool-panel" id="panel-add-spaces">
    <div class="tool-options">
      <div class="tool-options-title">ç©ºç™½è¿½åŠ ã‚ªãƒ—ã‚·ãƒ§ãƒ³</div>
      
      <div class="option-section">
        <div class="option-row">
          <label>
            <input type="checkbox" id="spaces-add-every-n"> 
            <input type="number" id="spaces-add-n" value="10" min="1" style="width:60px;"> æ–‡å­—ã”ã¨ã«ç©ºç™½ã‚’è¿½åŠ 
          </label>
        </div>
        <div class="option-row">
          <label>
            <input type="checkbox" id="spaces-add-after-char"> æŒ‡å®šæ–‡å­—ã®å¾Œã«ç©ºç™½ã‚’è¿½åŠ :
          </label>
          <input type="text" id="spaces-after-char" value="." style="max-width:80px;">
        </div>
        <div class="option-row">
          <label>
            <input type="checkbox" id="spaces-add-after-line"> å„è¡Œã®æœ«å°¾ã«ç©ºç™½ã‚’è¿½åŠ 
          </label>
        </div>
      </div>
    </div>
  </div>

  <!-- Convert Tool (æ–‡å­—å¤‰æ›) -->
  <div class="tool-panel" id="panel-convert">
    <div class="tool-options">
      <div class="tool-options-title">æ–‡å­—å¤‰æ›</div>
      
      <div class="option-section">
        <div class="option-section-title">â–  å¤§æ–‡å­—/å°æ–‡å­—</div>
        <div class="option-row">
          <button class="btn-primary btn-small" onclick="executeConvert('lowercase')">å°æ–‡å­—ã«å¤‰æ›</button>
          <button class="btn-primary btn-small" onclick="executeConvert('uppercase')">å¤§æ–‡å­—ã«å¤‰æ›</button>
          <button class="btn-primary btn-small" onclick="executeConvert('randomcase')">ãƒ©ãƒ³ãƒ€ãƒ </button>
          <button class="btn-primary btn-small" onclick="executeConvert('studlycaps')">äº¤äº’å¤§å°æ–‡å­—</button>
        </div>
        <div class="option-row">
          <button class="btn-primary btn-small" onclick="executeConvert('capitalizeWords')">å„å˜èªã®å…ˆé ­ã‚’å¤§æ–‡å­—</button>
          <button class="btn-primary btn-small" onclick="executeConvert('uncapitalizeWords')">å„å˜èªã®å…ˆé ­ã‚’å°æ–‡å­—</button>
        </div>
        <div class="option-row">
          <button class="btn-primary btn-small" onclick="executeConvert('capitalizeSentences')">å„æ–‡ã®å…ˆé ­ã‚’å¤§æ–‡å­—</button>
          <button class="btn-primary btn-small" onclick="executeConvert('uncapitalizeSentences')">å„æ–‡ã®å…ˆé ­ã‚’å°æ–‡å­—</button>
        </div>
        <div class="option-row">
          <button class="btn-primary btn-small" onclick="executeConvert('snakeCase')">snake_case</button>
          <button class="btn-primary btn-small" onclick="executeConvert('kebabCase')">kebab-case</button>
          <button class="btn-primary btn-small" onclick="executeConvert('camelCase')">camelCase</button>
          <button class="btn-primary btn-small" onclick="executeConvert('pascalCase')">PascalCase</button>
        </div>
      </div>

      <div class="option-section">
        <div class="option-section-title">â–  å…¨è§’/åŠè§’å¤‰æ›</div>
        <div class="option-row">
          <button class="btn-primary btn-small" onclick="executeConvert('toFullwidth')">å…¨è§’â†’åŠè§’</button>
          <button class="btn-primary btn-small" onclick="executeConvert('toHalfwidth')">åŠè§’â†’å…¨è§’</button>
        </div>
        <div class="option-row">
          <button class="btn-primary btn-small" onclick="executeConvert('hiraToFullKata')">åŠè§’ï¼‹ã²ã‚‰â†’å…¨è§’ãƒ»ã‚«ã‚¿ã‚«ãƒŠ</button>
          <button class="btn-primary btn-small" onclick="executeConvert('hiraToHalfKata')">åŠè§’ï¼‹å…¨ã‚«ã‚¿â†’å…¨è§’ãƒ»ã²ã‚‰ãŒãª</button>
        </div>
        <div class="option-row">
          <button class="btn-primary btn-small" onclick="executeConvert('alphaToFull')">å…¨è§’è‹±æ•°â†’åŠè§’è‹±æ•°</button>
          <button class="btn-primary btn-small" onclick="executeConvert('alphaToHalf')">åŠè§’è‹±æ•°â†’å…¨è§’è‹±æ•°</button>
        </div>
        <div class="option-row">
          <button class="btn-primary btn-small" onclick="executeConvert('kataToFull')">å…¨è§’ã‚«ã‚¿ã‚«ãƒŠâ†’åŠè§’ã‚«ã‚¿ã‚«ãƒŠ</button>
          <button class="btn-primary btn-small" onclick="executeConvert('kataToHalf')">åŠè§’ã‚«ã‚¿ã‚«ãƒŠâ†’å…¨è§’ã‚«ã‚¿ã‚«ãƒŠ</button>
        </div>
        <div class="option-row">
          <button class="btn-primary btn-small" onclick="executeConvert('hiraToKata')">ã²ã‚‰ãŒãªâ†’ã‚«ã‚¿ã‚«ãƒŠ</button>
          <button class="btn-primary btn-small" onclick="executeConvert('kataToHira')">ã‚«ã‚¿ã‚«ãƒŠâ†’ã²ã‚‰ãŒãª</button>
        </div>
      </div>

      <div class="option-section">
        <div class="option-section-title">â–  ã‚¹ãƒšãƒ¼ã‚¹/TABå¤‰æ›</div>
        <div class="option-row">
          <button class="btn-primary btn-small" onclick="executeConvert('tabToSpace')">TABâ†’ç©ºç™½</button>
          <button class="btn-primary btn-small" onclick="executeConvert('spaceToTab')">ç©ºç™½â†’TAB</button>
          <label style="margin-left:10px;">ã‚¹ãƒšãƒ¼ã‚¹æ•°: <input type="number" id="convert-tab-spaces" value="4" min="1" max="16" style="width:70px;"></label>
        </div>
      </div>
    </div>
  </div>

  <!-- Line Operations Tool (è¡Œæ“ä½œ) -->
  <div class="tool-panel" id="panel-line-ops">
    <div class="tool-options">
      <div class="tool-options-title">è¡Œæ“ä½œ</div>
      
      <div class="option-section">
        <div class="option-section-title">â–  ç©ºç™½ã‚’å‰Šé™¤</div>
        <div class="option-row">
          <button class="btn-primary btn-small" onclick="executeLineOps('trimLeft')">å·¦(å…ˆé ­)ã®ç©ºç™½ã‚’å‰Šé™¤</button>
          <button class="btn-primary btn-small" onclick="executeLineOps('trimRight')">å³(æœ«å°¾)ã®ç©ºç™½ã‚’å‰Šé™¤</button>
        </div>
      </div>

      <div class="option-section">
        <div class="option-section-title">â–  ã‚½ãƒ¼ãƒˆ</div>
        <div class="option-row">
          <label>åŒºåˆ‡ã‚Šæ–‡å­—:</label>
          <input type="text" id="sort-delimiter" value="" placeholder="ç©ºæ¬„=è¡Œå…¨ä½“" style="max-width:80px;">
          <label>åˆ—ç•ªå·:</label>
          <input type="number" id="sort-column" value="1" min="1" style="max-width:60px;">
          <span style="font-size:0.7rem; color:var(--text-muted);">â€»åŒºåˆ‡ã‚Šæ–‡å­—ã‚’æŒ‡å®šã—ãŸå ´åˆã®ã¿æœ‰åŠ¹</span>
        </div>
        <div class="option-row">
          <button class="btn-primary btn-small" onclick="executeLineOps('sortAlpha')">ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †</button>
          <button class="btn-secondary btn-small" onclick="executeLineOps('sortAlphaCase')">AaåŒºåˆ¥</button>
          <button class="btn-primary btn-small" onclick="executeLineOps('sortNatural')">è‡ªç„¶é †</button>
          <button class="btn-secondary btn-small" onclick="executeLineOps('sortNaturalCase')">AaåŒºåˆ¥</button>
          <button class="btn-primary btn-small" onclick="executeLineOps('sortLength')">æ–‡å­—æ•°é †</button>
        </div>
        <div class="option-row">
          <button class="btn-primary btn-small" onclick="executeLineOps('sortRandom')">ãƒ©ãƒ³ãƒ€ãƒ </button>
          <button class="btn-primary btn-small" onclick="executeLineOps('sortReverse')">é€†é †</button>
          <label style="margin-left:15px;">
            <input type="checkbox" id="sort-desc"> é™é †ï¼ˆZâ†’Aï¼‰
          </label>
        </div>
      </div>

      <div class="option-section">
        <div class="option-section-title">â–  é‡è¤‡è¡Œå‰Šé™¤</div>
        <div class="option-row">
          <label>
            <input type="checkbox" id="dup-case" checked> å¤§æ–‡å­—å°æ–‡å­—ã‚’åŒºåˆ¥
          </label>
          <label>
            <input type="checkbox" id="dup-trim"> å‰å¾Œã®ç©ºç™½ã‚’ç„¡è¦–
          </label>
          <label>
            <input type="checkbox" id="dup-keep-order" checked> å‡ºç¾é †åºã‚’ä¿æŒ
          </label>
        </div>
        <div class="option-row">
          <button class="btn-primary btn-small" onclick="executeLineOps('removeDuplicates')">ã™ã¹ã¦ã®é‡è¤‡è¡Œã‚’å‰Šé™¤</button>
          <button class="btn-primary btn-small" onclick="executeLineOps('uniq')">é€£ç¶šã—ãŸé‡è¤‡è¡Œã®ã¿å‰Šé™¤ (uniq)</button>
        </div>
      </div>

      <div class="option-section">
        <div class="option-section-title">â–  è¡Œçµåˆ</div>
        <div class="option-row">
          <label>çµåˆæ–‡å­—:</label>
          <input type="text" id="combine-delimiter" placeholder="ä¾‹: , (ç©ºæ¬„ã§ç›´æ¥çµåˆ)" style="max-width:120px;">
          <label>
            <input type="checkbox" id="combine-skip-empty" checked> ç©ºè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—
          </label>
        </div>
        <div class="option-row">
          <button class="btn-primary btn-small" onclick="executeLineOps('combine')">è¡Œã‚’çµåˆ</button>
        </div>
      </div>

      <div class="option-section">
        <div class="option-section-title">â–  ç©ºè¡Œå‰Šé™¤</div>
        <div class="option-row">
          <label>
            <input type="checkbox" id="empty-whitespace" checked> ç©ºç™½ã®ã¿ã®è¡Œã‚‚å‰Šé™¤
          </label>
        </div>
        <div class="option-row">
          <button class="btn-primary btn-small" onclick="executeLineOps('removeEmpty')">ç©ºè¡Œã‚’å‰Šé™¤</button>
        </div>
      </div>

      <div class="option-section">
        <div class="option-section-title">â–  æŒ‡å®šæ–‡å­—åˆ—ã§è¡Œã‚’ãƒ•ã‚£ãƒ«ã‚¿</div>
        <div class="option-row">
          <label>æ¤œç´¢æ–‡å­—åˆ—:</label>
          <input type="text" id="filter-text" placeholder="æ¤œç´¢ã™ã‚‹æ–‡å­—åˆ—" style="flex:1; max-width:300px;">
        </div>
        <div class="option-row">
          <label>
            <input type="checkbox" id="filter-case"> å¤§æ–‡å­—å°æ–‡å­—ã‚’åŒºåˆ¥
          </label>
          <label>
            <input type="checkbox" id="filter-regex"> æ­£è¦è¡¨ç¾ã‚’ä½¿ç”¨
          </label>
          <label>
            <input type="checkbox" id="filter-show-removed"> å‰Šé™¤ã•ã‚ŒãŸè¡Œã‚’è¡¨ç¤º
          </label>
        </div>
        <div class="option-row">
          <button class="btn-primary btn-small" onclick="executeLineOps('filterContaining')">å«ã‚€è¡Œã‚’å‰Šé™¤</button>
          <button class="btn-primary btn-small" onclick="executeLineOps('filterNotContaining')">å«ã¾ãªã„è¡Œã‚’å‰Šé™¤</button>
        </div>
        <div id="filter-removed-count" style="font-size:0.8rem; color:var(--accent); margin-top:5px;"></div>
      </div>

      <div class="option-section">
        <div class="option-section-title">â–  ç¹°ã‚Šè¿”ã—ç”Ÿæˆ</div>
        <div class="option-row">
          <label>ç¹°ã‚Šè¿”ã—å›æ•°:</label>
          <input type="number" id="repeat-count" value="10" min="1" max="10000" style="max-width:80px;">
          <label>1è¡Œã‚ãŸã‚Šã®å€‹æ•°:</label>
          <input type="number" id="repeat-per-row" value="1" min="1" max="1000" style="max-width:80px;">
        </div>
        <div class="option-row">
          <label>åŒºåˆ‡ã‚Šæ–‡å­—:</label>
          <input type="text" id="repeat-separator" value="" placeholder="ç©ºæ¬„ã§ç›´æ¥é€£çµ" style="max-width:100px;">
          <label>
            <input type="checkbox" id="repeat-each-line"> å„è¡Œã‚’å€‹åˆ¥ã«ç¹°ã‚Šè¿”ã™
          </label>
        </div>
        <div class="option-row">
          <button class="btn-primary btn-small" onclick="executeLineOps('repeat')">ç¹°ã‚Šè¿”ã—ç”Ÿæˆ</button>
        </div>
      </div>
    </div>
  </div>

  <div class="execute-section">
    <button class="btn-primary btn-execute" id="executeButton" onclick="execute()">å®Ÿè¡Œ</button>
    <button class="btn-secondary" onclick="clearAll()">ã‚¯ãƒªã‚¢</button>
    <button class="btn-secondary" id="swapButton" onclick="swapTexts()">â‡„ å…¥å‡ºåŠ›å…¥æ›¿</button>
  </div>

  <div class="main-content">
    <div class="panel input-panel" id="inputPanel">
      <div class="panel-header">
        <span class="panel-title">å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆ</span>
        <div class="panel-actions">
          <button class="btn-secondary btn-small" onclick="sortInput('asc')">â–² æ˜‡é †</button>
          <button class="btn-secondary btn-small" onclick="sortInput('desc')">â–¼ é™é †</button>
        </div>
      </div>
      <div class="panel-body">
        <textarea id="inputText" placeholder="ã“ã“ã«ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›..."></textarea>
      </div>
      <div class="stats-bar" id="inputStats">
        <div class="stat-item">
          <span class="stat-label">æ–‡å­—æ•°:</span>
          <span class="stat-value" id="input-chars">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">ç©ºç™½è¾¼ã¿æ–‡å­—æ•°:</span>
          <span class="stat-value" id="input-chars-with-spaces">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">æ”¹è¡Œæ•°:</span>
          <span class="stat-value" id="input-newlines">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">æ”¹è¡Œè¾¼ã¿æ–‡å­—æ•°:</span>
          <span class="stat-value" id="input-chars-with-newlines">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">è¡Œæ•°:</span>
          <span class="stat-value" id="input-lines">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">å˜èªæ•°:</span>
          <span class="stat-value" id="input-words">0</span>
        </div>
      </div>
    </div>

    <div class="panel output-panel">
      <div class="panel-header">
        <span class="panel-title">å‡ºåŠ›çµæœ</span>
        <div class="panel-actions">
          <button class="btn-secondary btn-small" onclick="copyToClipboard()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
          <button class="btn-secondary btn-small" onclick="downloadOutput()">ğŸ“¥ ä¿å­˜</button>
        </div>
      </div>
      <div class="panel-body">
        <textarea id="outputText" placeholder="å‡¦ç†çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™..." readonly></textarea>
      </div>
      <div class="stats-bar" id="outputStats">
        <div class="stat-item">
          <span class="stat-label">æ–‡å­—æ•°:</span>
          <span class="stat-value" id="output-chars">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">ç©ºç™½è¾¼ã¿æ–‡å­—æ•°:</span>
          <span class="stat-value" id="output-chars-with-spaces">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">æ”¹è¡Œæ•°:</span>
          <span class="stat-value" id="output-newlines">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">æ”¹è¡Œè¾¼ã¿æ–‡å­—æ•°:</span>
          <span class="stat-value" id="output-chars-with-newlines">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">è¡Œæ•°:</span>
          <span class="stat-value" id="output-lines">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">å˜èªæ•°:</span>
          <span class="stat-value" id="output-words">0</span>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <p>ã“ã®ãƒ„ãƒ¼ãƒ«ã¯é€šä¿¡ç„¡ã—ã§ãƒ–ãƒ©ã‚¦ã‚¶å†…ã§å‹•ä½œã—ã¾ã™ã€‚</p>
  </footer>
</div>

<script>
// Current tool
let currentTool = 'prefix-suffix';

// Theme
function setTheme(theme) {
  if (theme === 'light') {
    document.documentElement.removeAttribute('data-theme');
  } else {
    document.documentElement.setAttribute('data-theme', theme);
  }
  document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
  document.querySelector(`.theme-btn.${theme}`).classList.add('active');
}

// Tab switching
document.querySelectorAll('.tool-tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.tool-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tool-panel').forEach(p => p.classList.remove('active'));
    tab.classList.add('active');
    currentTool = tab.dataset.tool;
    document.getElementById(`panel-${currentTool}`).classList.add('active');
    
    // å…¥åŠ›ãƒ‘ãƒãƒ«ã€å‡ºåŠ›ãƒ‘ãƒãƒ«ã€å…¥å‡ºåŠ›å…¥æ›¿ãƒœã‚¿ãƒ³ã€å®Ÿè¡Œãƒœã‚¿ãƒ³ã®è¡¨ç¤ºåˆ¶å¾¡
    const inputPanel = document.getElementById('inputPanel');
    const outputPanel = document.querySelector('.output-panel');
    const mainContent = document.querySelector('.main-content');
    const swapButton = document.getElementById('swapButton');
    const executeButton = document.getElementById('executeButton');
    
    // çµ„ã¿åˆã‚ã›ç”Ÿæˆ: å…¥åŠ›ãƒ‘ãƒãƒ«éè¡¨ç¤ºã€å‡ºåŠ›å…¨å¹…ã€å…¥å‡ºåŠ›å…¥æ›¿éè¡¨ç¤º
    if (currentTool === 'combination') {
      inputPanel.style.display = 'none';
      outputPanel.style.display = 'block';
      mainContent.classList.add('full-width');
      swapButton.style.display = 'none';
      executeButton.style.display = 'inline-block';
    } 
    // åˆ—æŠ½å‡º: å‡ºåŠ›ãƒ‘ãƒãƒ«éè¡¨ç¤ºï¼ˆå°‚ç”¨ã®çµæœã‚¨ãƒªã‚¢ã‚’ä½¿ç”¨ï¼‰
    else if (currentTool === 'column-extract') {
      inputPanel.style.display = 'block';
      outputPanel.style.display = 'none';
      mainContent.classList.remove('full-width');
      swapButton.style.display = 'none';
      executeButton.style.display = 'none';
      document.getElementById('column-results').style.display = 'none';
    }
    // æ”¹è¡Œè¿½åŠ /å‰Šé™¤ã€æ–‡å­—å¤‰æ›ã€è¡Œæ“ä½œ: å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ãƒœã‚¿ãƒ³ãŒã‚ã‚‹ã®ã§å®Ÿè¡Œãƒœã‚¿ãƒ³éè¡¨ç¤º
    else if (currentTool === 'line-breaks' || currentTool === 'convert' || currentTool === 'line-ops') {
      inputPanel.style.display = 'block';
      outputPanel.style.display = 'block';
      mainContent.classList.remove('full-width');
      swapButton.style.display = 'inline-block';
      executeButton.style.display = 'none';
    }
    // ãã®ä»–: é€šå¸¸è¡¨ç¤º
    else {
      inputPanel.style.display = 'block';
      outputPanel.style.display = 'block';
      mainContent.classList.remove('full-width');
      swapButton.style.display = 'inline-block';
      executeButton.style.display = 'inline-block';
    }
  });
});

// Update stats
function updateStats(textareaId, prefix) {
  const text = document.getElementById(textareaId).value;
  
  // æ–‡å­—æ•°ï¼ˆç©ºç™½ãƒ»æ”¹è¡Œé™¤ãï¼‰
  const charsNoSpaces = text.replace(/[\sã€€]/g, '').length;
  // ç©ºç™½è¾¼ã¿æ–‡å­—æ•°ï¼ˆæ”¹è¡Œé™¤ãï¼‰
  const charsWithSpaces = text.replace(/\n/g, '').length;
  // æ”¹è¡Œæ•°
  const newlines = (text.match(/\n/g) || []).length;
  // æ”¹è¡Œè¾¼ã¿æ–‡å­—æ•°
  const charsWithNewlines = text.length;
  // è¡Œæ•°
  const lines = text ? text.split('\n').length : 0;
  // å˜èªæ•°
  const words = text.trim() ? text.trim().split(/\s+/).length : 0;
  
  document.getElementById(`${prefix}-chars`).textContent = charsNoSpaces.toLocaleString();
  document.getElementById(`${prefix}-chars-with-spaces`).textContent = charsWithSpaces.toLocaleString();
  document.getElementById(`${prefix}-newlines`).textContent = newlines.toLocaleString();
  document.getElementById(`${prefix}-chars-with-newlines`).textContent = charsWithNewlines.toLocaleString();
  document.getElementById(`${prefix}-lines`).textContent = lines.toLocaleString();
  document.getElementById(`${prefix}-words`).textContent = words.toLocaleString();
}

document.getElementById('inputText').addEventListener('input', () => updateStats('inputText', 'input'));
document.getElementById('outputText').addEventListener('input', () => updateStats('outputText', 'output'));

// Execute
function execute() {
  const input = document.getElementById('inputText').value;
  let output = '';
  
  switch(currentTool) {
    case 'prefix-suffix':
      output = executePrefixSuffix(input);
      break;
    case 'line-breaks':
      output = executeLineBreaks(input);
      break;
    case 'count':
      output = executeCount(input);
      break;
    case 'column-extract':
      output = executeColumnExtract(input);
      break;
    case 'find-replace':
      output = executeFindReplace(input);
      break;
    case 'combination':
      output = executeCombination(input);
      break;
    case 'remove-spaces':
      output = executeRemoveSpaces(input);
      break;
    case 'add-spaces':
      output = executeAddSpacesMain(input);
      break;
  }
  
  document.getElementById('outputText').value = output;
  updateStats('outputText', 'output');
}

// Tool implementations
function executePrefixSuffix(input) {
  const prefix = document.getElementById('prefix-text').value;
  const suffix = document.getElementById('suffix-text').value;
  const skipEmpty = document.getElementById('prefix-skip-empty').checked;
  
  return input.split('\n').map(line => {
    if (skipEmpty && line.trim() === '') return line;
    return prefix + line + suffix;
  }).join('\n');
}

// Line breaks - Remove all
function executeLineBreakRemoveAll() {
  const input = document.getElementById('inputText').value;
  const replaceWith = document.getElementById('lb-remove-replace').value;
  const output = input.replace(/\n/g, replaceWith);
  document.getElementById('outputText').value = output;
  updateStats('outputText', 'output');
}

// Line breaks - At specific text
function executeLineBreakAtText() {
  let input = document.getElementById('inputText').value;
  const targetText = document.getElementById('lb-target-text').value;
  const position = document.querySelector('input[name="lb-position"]:checked').value;
  const caseSensitive = document.getElementById('lb-case-sensitive').checked;
  const removeExisting = document.getElementById('lb-remove-existing').checked;
  
  if (!targetText) {
    alert('å¯¾è±¡æ–‡å­—åˆ—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
    return;
  }
  
  // æ—¢å­˜ã®æ”¹è¡Œã‚’å‰Šé™¤
  if (removeExisting) {
    input = input.replace(/\n/g, '');
  }
  
  // æ”¹è¡Œã‚’è¿½åŠ 
  const flags = caseSensitive ? 'g' : 'gi';
  const escaped = targetText.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
  const regex = new RegExp(escaped, flags);
  
  let output;
  if (position === 'after') {
    output = input.replace(regex, match => match + '\n');
  } else {
    output = input.replace(regex, match => '\n' + match);
  }
  
  document.getElementById('outputText').value = output;
  updateStats('outputText', 'output');
}

// Line breaks - Every N characters
function executeLineBreakEveryN() {
  let input = document.getElementById('inputText').value;
  const n = parseInt(document.getElementById('lb-every-n').value) || 80;
  const wordwrap = document.getElementById('lb-wordwrap').checked;
  const escapeExisting = document.getElementById('lb-escape-existing').checked;
  
  // æ—¢å­˜ã®æ”¹è¡Œã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
  if (escapeExisting) {
    input = input.replace(/\n/g, '\\n');
  }
  
  let output = '';
  
  if (wordwrap) {
    // å˜èªã®é€”ä¸­ã§åˆ‡ã‚‰ãªã„
    const words = input.split(/(\s+)/);
    let currentLine = '';
    
    for (const word of words) {
      if (currentLine.length + word.length > n && currentLine.length > 0) {
        output += currentLine.trimEnd() + '\n';
        currentLine = word.trimStart();
      } else {
        currentLine += word;
      }
    }
    if (currentLine) {
      output += currentLine;
    }
  } else {
    // å˜ç´”ã«Næ–‡å­—ã”ã¨ã«æ”¹è¡Œ
    for (let i = 0; i < input.length; i += n) {
      output += input.substring(i, i + n);
      if (i + n < input.length) {
        output += '\n';
      }
    }
  }
  
  document.getElementById('outputText').value = output;
  updateStats('outputText', 'output');
}

// Line breaks - Add after each line
function executeLineBreakAddAfterEach() {
  const input = document.getElementById('inputText').value;
  const output = input.split('\n').join('\n\n');
  document.getElementById('outputText').value = output;
  updateStats('outputText', 'output');
}

// Line breaks - Add before each line
function executeLineBreakAddBeforeEach() {
  const input = document.getElementById('inputText').value;
  const output = input.split('\n').map((line, i) => i === 0 ? line : '\n' + line).join('\n');
  document.getElementById('outputText').value = output;
  updateStats('outputText', 'output');
}

// Line breaks - Merge multiple empty lines
function executeLineBreakMergeMultiple() {
  const input = document.getElementById('inputText').value;
  const output = input.replace(/\n{3,}/g, '\n\n');
  document.getElementById('outputText').value = output;
  updateStats('outputText', 'output');
}

function executeLineBreaks(input) {
  // This function is no longer used for line-breaks tool
  // Each operation has its own button now
  return input;
}

function executeCount(input) {
  const noSpaces = document.getElementById('count-no-spaces').checked;
  const noHtml = document.getElementById('count-no-html').checked;
  const linebreakAsSpace = document.getElementById('count-linebreak-space').checked;
  
  let text = input;
  
  // HTMLã‚¿ã‚°ã‚’é™¤å¤–
  if (noHtml) {
    text = text.replace(/<[^>]*>/g, '');
  }
  
  // æ”¹è¡Œã‚’ã‚¹ãƒšãƒ¼ã‚¹ã¨ã—ã¦ã‚«ã‚¦ãƒ³ãƒˆ
  if (linebreakAsSpace) {
    text = text.replace(/\n/g, ' ');
  }
  
  // æ–‡å­—æ•°è¨ˆç®—
  const charCountTotal = text.length;
  const charCountNoNewline = text.replace(/\n/g, '').length;
  const charCountNoSpace = text.replace(/[\sã€€]/g, '').length;
  
  // å˜èªæ•°ï¼ˆè‹±å˜èªã¨æ—¥æœ¬èªã‚’è€ƒæ…®ï¼‰
  const wordCount = text.trim() ? text.trim().split(/\s+/).filter(w => w).length : 0;
  
  // æ–‡æ•°ï¼ˆå¥ç‚¹ãƒ»ãƒ”ãƒªã‚ªãƒ‰ãƒ»æ„Ÿå˜†ç¬¦ãƒ»ç–‘å•ç¬¦ã§åŒºåˆ‡ã‚‹ï¼‰
  const sentences = text.split(/[.!?ã€‚ï¼ï¼Ÿ]+/).filter(s => s.trim());
  const sentenceCount = sentences.length;
  
  // æ®µè½æ•°ï¼ˆç©ºè¡Œã§åŒºåˆ‡ã‚‰ã‚ŒãŸãƒ–ãƒ­ãƒƒã‚¯ï¼‰
  const paragraphs = input.split(/\n\s*\n/).filter(p => p.trim());
  const paragraphCount = paragraphs.length || (input.trim() ? 1 : 0);
  
  // è¡Œæ•°
  const lineCount = input.split('\n').length;
  
  // åŸç¨¿ç”¨ç´™ï¼ˆ400å­—è©°ã‚ï¼‰
  const genkoCount = Math.ceil(charCountNoSpace / 400);
  
  // æ–‡å­—ç¨®åˆ¥ã‚«ã‚¦ãƒ³ãƒˆ
  const hiraganaCount = (text.match(/[\u3041-\u3096]/g) || []).length;
  const katakanaCount = (text.match(/[\u30A1-\u30F6\uFF66-\uFF9F]/g) || []).length;
  const kanjiCount = (text.match(/[\u4E00-\u9FFF\u3400-\u4DBF]/g) || []).length;
  const alphaCount = (text.match(/[A-Za-zï¼¡-ï¼ºï½-ï½š]/g) || []).length;
  const digitCount = (text.match(/[0-9ï¼-ï¼™]/g) || []).length;
  const symbolCount = charCountNoSpace - hiraganaCount - katakanaCount - kanjiCount - alphaCount - digitCount;
  
  // ç•°ä½“å­—ï¼ˆIVS: ç•°ä½“å­—ã‚»ãƒ¬ã‚¯ã‚¿ã‚’å«ã‚€æ–‡å­—ï¼‰
  const variantCount = (input.match(/[\uDB40-\uDBFF][\uDD00-\uDDEF]/g) || []).length;
  
  // ãƒã‚¤ãƒˆæ•°è¨ˆç®—
  const utf8Bytes = new Blob([input]).size;
  const utf16Bytes = input.length * 2 + 2; // BOMå«ã‚€æ¦‚ç®—
  
  // Shift-JISæ¦‚ç®—ï¼ˆæ—¥æœ¬èª3ãƒã‚¤ãƒˆâ†’2ãƒã‚¤ãƒˆã€ASCII1ãƒã‚¤ãƒˆï¼‰
  let sjisBytes = 0;
  for (const char of input) {
    const code = char.charCodeAt(0);
    if (code <= 0x7F) {
      sjisBytes += 1; // ASCII
    } else if (code >= 0xFF61 && code <= 0xFF9F) {
      sjisBytes += 1; // åŠè§’ã‚«ãƒŠ
    } else {
      sjisBytes += 2; // ãã®ä»–ã®æ—¥æœ¬èª
    }
  }
  
  // EUC-JPæ¦‚ç®—
  let eucjpBytes = 0;
  for (const char of input) {
    const code = char.charCodeAt(0);
    if (code <= 0x7F) {
      eucjpBytes += 1;
    } else if (code >= 0xFF61 && code <= 0xFF9F) {
      eucjpBytes += 2; // åŠè§’ã‚«ãƒŠã¯2ãƒã‚¤ãƒˆ
    } else {
      eucjpBytes += 2;
    }
  }
  
  // JISæ¦‚ç®—ï¼ˆISO-2022-JPï¼‰
  let jisBytes = eucjpBytes + Math.ceil(input.length / 10) * 3; // ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹æ¦‚ç®—
  
  // ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ›´æ–°
  document.getElementById('count-chars').innerHTML = `<strong>${charCountTotal.toLocaleString()}</strong> æ–‡å­—`;
  document.getElementById('count-chars-no-newline').innerHTML = `<strong>${charCountNoNewline.toLocaleString()}</strong> æ–‡å­—`;
  document.getElementById('count-chars-no-space').innerHTML = `<strong>${charCountNoSpace.toLocaleString()}</strong> æ–‡å­—`;
  document.getElementById('count-lines').innerHTML = `<strong>${lineCount.toLocaleString()}</strong> è¡Œ`;
  document.getElementById('count-genko').innerHTML = `<strong>${genkoCount.toLocaleString()}</strong> æš`;
  document.getElementById('count-variant').innerHTML = `<strong>${variantCount.toLocaleString()}</strong> æ–‡å­—`;
  
  document.getElementById('count-utf8').innerHTML = `<strong>${utf8Bytes.toLocaleString()}</strong> ãƒã‚¤ãƒˆ`;
  document.getElementById('count-utf16').innerHTML = `<strong>${utf16Bytes.toLocaleString()}</strong> ãƒã‚¤ãƒˆ`;
  document.getElementById('count-sjis').innerHTML = `<strong>${sjisBytes.toLocaleString()}</strong> ãƒã‚¤ãƒˆ`;
  document.getElementById('count-eucjp').innerHTML = `<strong>${eucjpBytes.toLocaleString()}</strong> ãƒã‚¤ãƒˆ`;
  document.getElementById('count-jis').innerHTML = `<strong>${jisBytes.toLocaleString()}</strong> ãƒã‚¤ãƒˆ`;
  
  // æ–‡å­—ç¨®åˆ¥
  document.getElementById('count-hiragana').textContent = hiraganaCount.toLocaleString();
  document.getElementById('count-katakana').textContent = katakanaCount.toLocaleString();
  document.getElementById('count-kanji').textContent = kanjiCount.toLocaleString();
  document.getElementById('count-alpha').textContent = alphaCount.toLocaleString();
  document.getElementById('count-digit').textContent = digitCount.toLocaleString();
  document.getElementById('count-symbol').textContent = Math.max(0, symbolCount).toLocaleString();
  
  // è©³ç´°
  document.getElementById('count-words').textContent = wordCount.toLocaleString();
  document.getElementById('count-sentences').textContent = sentenceCount.toLocaleString();
  document.getElementById('count-paragraphs').textContent = paragraphCount.toLocaleString();
  
  // ã‚«ã‚¹ã‚¿ãƒ ã‚«ã‚¦ãƒ³ãƒˆ
  updateCustomCount(input);
  
  // å‡ºåŠ›ãƒ†ã‚­ã‚¹ãƒˆ
  let output = `=== æ–‡å­—ã‚«ã‚¦ãƒ³ãƒˆçµæœ ===\n`;
  output += `æ–‡å­—æ•°: ${charCountTotal.toLocaleString()}\n`;
  output += `æ”¹è¡Œé™¤ã: ${charCountNoNewline.toLocaleString()}\n`;
  output += `æ”¹è¡Œãƒ»ç©ºç™½é™¤ã: ${charCountNoSpace.toLocaleString()}\n`;
  output += `è¡Œæ•°: ${lineCount.toLocaleString()}\n`;
  output += `åŸç¨¿ç”¨ç´™: ${genkoCount.toLocaleString()} æš\n`;
  output += `\n=== ãƒã‚¤ãƒˆæ•° ===\n`;
  output += `UTF-8: ${utf8Bytes.toLocaleString()} ãƒã‚¤ãƒˆ\n`;
  output += `UTF-16: ${utf16Bytes.toLocaleString()} ãƒã‚¤ãƒˆ\n`;
  output += `Shift-JIS: ${sjisBytes.toLocaleString()} ãƒã‚¤ãƒˆ\n`;
  output += `EUC-JP: ${eucjpBytes.toLocaleString()} ãƒã‚¤ãƒˆ\n`;
  output += `JIS: ${jisBytes.toLocaleString()} ãƒã‚¤ãƒˆ\n`;
  output += `\n=== æ–‡å­—ç¨®åˆ¥ ===\n`;
  output += `ã²ã‚‰ãŒãª: ${hiraganaCount.toLocaleString()}\n`;
  output += `ã‚«ã‚¿ã‚«ãƒŠ: ${katakanaCount.toLocaleString()}\n`;
  output += `æ¼¢å­—: ${kanjiCount.toLocaleString()}\n`;
  output += `è‹±å­—: ${alphaCount.toLocaleString()}\n`;
  output += `æ•°å­—: ${digitCount.toLocaleString()}\n`;
  output += `è¨˜å·ç­‰: ${Math.max(0, symbolCount).toLocaleString()}\n`;
  
  return output;
}

// ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚«ã‚¦ãƒ³ãƒˆæ›´æ–°
function updateRealtimeCount() {
  const realtime = document.getElementById('count-realtime');
  if (realtime && realtime.checked && currentTool === 'count') {
    const input = document.getElementById('inputText').value;
    executeCount(input);
  }
}

function updateCustomCount(input) {
  const query = document.getElementById('count-custom-query').value;
  const caseSensitive = document.getElementById('count-custom-case').checked;
  const resultSpan = document.getElementById('count-custom-result');
  
  if (!query) {
    resultSpan.textContent = '';
    return;
  }
  
  const flags = caseSensitive ? 'g' : 'gi';
  const escaped = query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
  const regex = new RegExp(escaped, flags);
  const matches = input.match(regex);
  const count = matches ? matches.length : 0;
  
  resultSpan.textContent = `${count} ä»¶è¦‹ã¤ã‹ã‚Šã¾ã—ãŸ`;
}

function showWordFrequency() {
  const input = document.getElementById('inputText').value;
  const resultDiv = document.getElementById('word-frequency-result');
  
  if (!input.trim()) {
    resultDiv.style.display = 'none';
    return;
  }
  
  // å˜èªã‚’æŠ½å‡ºï¼ˆè‹±å˜èªãƒ»æ—¥æœ¬èªãƒ»æ•°å­—ã‚’å«ã‚€ï¼‰
  const words = input.toLowerCase().match(/[\p{L}\p{N}]+/gu) || [];
  const freq = {};
  words.forEach(w => freq[w] = (freq[w] || 0) + 1);
  
  const sorted = Object.entries(freq).sort((a, b) => b[1] - a[1]);
  const total = words.length;
  
  let html = `<table class="word-freq-table">
    <thead>
      <tr><th>å˜èª</th><th>å›æ•°</th><th>é »åº¦</th></tr>
    </thead>
    <tbody>`;
  
  sorted.slice(0, 50).forEach(([word, count]) => {
    const percent = ((count / total) * 100).toFixed(1);
    html += `<tr><td>${word}</td><td>${count}</td><td>${percent}%</td></tr>`;
  });
  
  html += `</tbody></table>`;
  html += `<p style="font-size:0.75rem; color:var(--text-muted); margin-top:8px;">ç·å˜èªæ•°: ${total} / ãƒ¦ãƒ‹ãƒ¼ã‚¯: ${sorted.length}</p>`;
  
  resultDiv.innerHTML = html;
  resultDiv.style.display = 'block';
}

// æ–‡å­—é »åº¦åˆ†æ
function showCharFrequency() {
  const input = document.getElementById('inputText').value;
  const resultDiv = document.getElementById('word-frequency-result');
  
  if (!input.trim()) {
    resultDiv.style.display = 'none';
    return;
  }
  
  // æ–‡å­—ã‚’ã‚«ã‚¦ãƒ³ãƒˆï¼ˆç©ºç™½ãƒ»æ”¹è¡Œé™¤ãï¼‰
  const chars = input.replace(/[\s\n]/g, '').split('');
  const freq = {};
  chars.forEach(c => freq[c] = (freq[c] || 0) + 1);
  
  const sorted = Object.entries(freq).sort((a, b) => b[1] - a[1]);
  const total = chars.length;
  
  let html = `<table class="word-freq-table">
    <thead>
      <tr><th>æ–‡å­—</th><th>å›æ•°</th><th>é »åº¦</th></tr>
    </thead>
    <tbody>`;
  
  sorted.slice(0, 50).forEach(([char, count]) => {
    const percent = ((count / total) * 100).toFixed(1);
    const displayChar = char === ' ' ? '(ç©ºç™½)' : char;
    html += `<tr><td>${displayChar}</td><td>${count}</td><td>${percent}%</td></tr>`;
  });
  
  html += `</tbody></table>`;
  html += `<p style="font-size:0.75rem; color:var(--text-muted); margin-top:8px;">ç·æ–‡å­—æ•°: ${total} / ãƒ¦ãƒ‹ãƒ¼ã‚¯: ${sorted.length}</p>`;
  
  resultDiv.innerHTML = html;
  resultDiv.style.display = 'block';
}

// ã‚«ã‚¹ã‚¿ãƒ ã‚«ã‚¦ãƒ³ãƒˆã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
document.addEventListener('DOMContentLoaded', function() {
  const customQueryInput = document.getElementById('count-custom-query');
  const customCaseCheckbox = document.getElementById('count-custom-case');
  
  if (customQueryInput) {
    customQueryInput.addEventListener('input', () => {
      const input = document.getElementById('inputText').value;
      updateCustomCount(input);
    });
  }
  
  if (customCaseCheckbox) {
    customCaseCheckbox.addEventListener('change', () => {
      const input = document.getElementById('inputText').value;
      updateCustomCount(input);
    });
  }
  
  // å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
  const inputText = document.getElementById('inputText');
  if (inputText) {
    inputText.addEventListener('input', () => {
      updateRealtimeCount();
    });
  }
});

function executeColumnExtract(input) {
  // æ—§ãƒãƒ¼ã‚¸ãƒ§ãƒ³äº’æ›ç”¨ï¼ˆãƒ†ã‚¹ãƒˆã§ä½¿ç”¨ï¼‰
  return executeColumnExtractMulti();
}

function executeColumnExtractMulti() {
  const input = document.getElementById('inputText').value;
  let colDelimiter = document.getElementById('column-delimiter-text').value;
  
  // ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å¯¾å¿œ
  colDelimiter = colDelimiter.replace(/\\t/g, '\t').replace(/\\n/g, '\n');
  
  const colCount = parseInt(document.getElementById('column-count').value) || 4;
  let rowDelimiter = document.getElementById('column-row-delimiter').value;
  rowDelimiter = rowDelimiter.replace(/\\t/g, '\t').replace(/\\n/g, '\n');
  
  const removeColDelim = document.getElementById('column-remove-col-delim').checked;
  const removeRowDelim = document.getElementById('column-remove-row-delim').checked;
  const hasTitle = document.getElementById('column-has-title').checked;
  let titleDelimiter = document.getElementById('column-title-delimiter').value;
  titleDelimiter = titleDelimiter.replace(/\\t/g, '\t').replace(/\\n/g, '\n');
  const removeEmpty = document.getElementById('column-remove-empty').checked;
  const trimValues = document.getElementById('column-trim').checked;
  
  // è¡Œã§åˆ†å‰²
  const rows = rowDelimiter === '\n' ? input.split('\n') : input.split(rowDelimiter);
  
  // å„åˆ—ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´
  const columns = Array.from({ length: colCount }, () => []);
  
  for (const row of rows) {
    if (removeEmpty && row.trim() === '') continue;
    
    let processedRow = row;
    
    // ã‚¿ã‚¤ãƒˆãƒ«åˆ—ã®å‡¦ç†
    let title = '';
    if (hasTitle && titleDelimiter) {
      const titleIdx = processedRow.indexOf(titleDelimiter);
      if (titleIdx !== -1) {
        title = processedRow.substring(0, titleIdx);
        processedRow = processedRow.substring(titleIdx + titleDelimiter.length);
      }
    }
    
    const parts = processedRow.split(colDelimiter);
    
    for (let i = 0; i < colCount; i++) {
      let val = parts[i] !== undefined ? parts[i] : '';
      
      // åˆ—åŒºåˆ‡ã‚Šæ–‡å­—ã‚’å‰Šé™¤
      if (removeColDelim && colDelimiter) {
        val = val.replace(new RegExp(escapeRegex(colDelimiter), 'g'), '');
      }
      
      // è¡ŒåŒºåˆ‡ã‚Šæ–‡å­—ã‚’å‰Šé™¤
      if (removeRowDelim && rowDelimiter && rowDelimiter !== '\n') {
        val = val.replace(new RegExp(escapeRegex(rowDelimiter), 'g'), '');
      }
      
      if (trimValues) val = val.trim();
      
      // ã‚¿ã‚¤ãƒˆãƒ«ã‚’æœ€åˆã®åˆ—ã«è¿½åŠ 
      if (hasTitle && i === 0 && title) {
        val = title + titleDelimiter + val;
      }
      
      columns[i].push(val);
    }
  }
  
  // çµæœãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç”Ÿæˆ
  const resultsDiv = document.getElementById('column-results');
  
  let html = '<table><tr>';
  for (let i = 0; i < colCount; i++) {
    html += `<th><div class="col-header"><span>Column #${i + 1}</span><button class="btn-copy-col" onclick="copyColumn(${i})">ã‚³ãƒ”ãƒ¼</button></div></th>`;
  }
  html += '</tr><tr>';
  for (let i = 0; i < colCount; i++) {
    html += `<td><textarea id="col-output-${i}" readonly>${columns[i].join('\n')}</textarea></td>`;
  }
  html += '</tr></table>';
  
  resultsDiv.innerHTML = html;
  resultsDiv.style.display = 'block';
  
  return columns[0].join('\n');
}

// æ­£è¦è¡¨ç¾ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ç”¨ãƒ˜ãƒ«ãƒ‘ãƒ¼
function escapeRegex(string) {
  return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

function copyColumn(colIndex) {
  const textarea = document.getElementById(`col-output-${colIndex}`);
  if (textarea) {
    navigator.clipboard.writeText(textarea.value).then(() => {
      const btn = event.target;
      const originalText = btn.textContent;
      btn.textContent = 'ã‚³ãƒ”ãƒ¼å®Œäº†!';
      setTimeout(() => btn.textContent = originalText, 1000);
    });
  }
}

function executeFindReplace(input) {
  const findText = document.getElementById('find-text').value;
  const replaceText = document.getElementById('replace-text').value;
  const useRegex = document.getElementById('find-regex').checked;
  const caseSensitive = document.getElementById('find-case').checked;
  
  if (!findText) return input;
  
  if (useRegex) {
    try {
      const flags = caseSensitive ? 'g' : 'gi';
      const regex = new RegExp(findText, flags);
      return input.replace(regex, replaceText);
    } catch(e) {
      return `æ­£è¦è¡¨ç¾ã‚¨ãƒ©ãƒ¼: ${e.message}`;
    }
  } else {
    if (caseSensitive) {
      return input.split(findText).join(replaceText);
    } else {
      const regex = new RegExp(findText.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
      return input.replace(regex, replaceText);
    }
  }
}

// Line combine (multiple lines to one line)
// Line combination generator (all combinations from multiple lists)
let comboListCount = 3; // åˆæœŸãƒªã‚¹ãƒˆæ•°

function updateComboCounts() {
  for (let i = 0; i < comboListCount; i++) {
    const textarea = document.getElementById(`combo-list-${i}`);
    const countSpan = document.getElementById(`combo-count-${i}`);
    if (textarea && countSpan) {
      const lines = textarea.value.split('\n').filter(line => line.trim() !== '');
      countSpan.textContent = lines.length;
    }
  }
  updateCombinationTotal();
}

function updateCombinationTotal() {
  const lists = [];
  for (let i = 0; i < comboListCount; i++) {
    const textarea = document.getElementById(`combo-list-${i}`);
    if (textarea) {
      const lines = textarea.value.split('\n').filter(line => line.trim() !== '');
      if (lines.length > 0) {
        lists.push(lines);
      }
    }
  }
  
  const total = lists.length > 0 ? lists.reduce((acc, list) => acc * list.length, 1) : 0;
  document.getElementById('combination-count').textContent = 
    total > 0 ? `${total.toLocaleString()} çµ„ã¿åˆã‚ã›ç”Ÿæˆäºˆå®š` : '';
}

function addComboList() {
  const container = document.getElementById('combinationInputs');
  const addBtn = container.querySelector('.combo-add');
  const suffix = container.querySelector('.combo-suffix');
  
  const newIndex = comboListCount;
  
  // æ–°ã—ã„åŒºåˆ‡ã‚Š
  const delimDiv = document.createElement('div');
  delimDiv.className = 'combo-item combo-delim';
  delimDiv.dataset.index = newIndex - 1;
  delimDiv.innerHTML = `
    <div class="combo-label">åŒºåˆ‡ã‚Š</div>
    <input type="text" class="combo-field combo-delim-field" id="combo-delim-${newIndex - 1}" placeholder="">
  `;
  
  // æ–°ã—ã„ãƒªã‚¹ãƒˆ
  const listDiv = document.createElement('div');
  listDiv.className = 'combo-item combo-list';
  listDiv.dataset.index = newIndex;
  listDiv.innerHTML = `
    <div class="combo-label">ãƒªã‚¹ãƒˆ ${newIndex + 1}</div>
    <textarea class="combo-textarea" id="combo-list-${newIndex}" placeholder="å„è¡Œã«1é …ç›®"></textarea>
    <div class="combo-count"><span id="combo-count-${newIndex}">0</span> è¡Œ</div>
  `;
  
  // Suffixã®å‰ã«æŒ¿å…¥
  container.insertBefore(delimDiv, suffix);
  container.insertBefore(listDiv, suffix);
  
  // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¿½åŠ 
  document.getElementById(`combo-list-${newIndex}`).addEventListener('input', updateComboCounts);
  
  comboListCount++;
}

function clearComboInputs() {
  document.getElementById('combo-prefix').value = '';
  document.getElementById('combo-suffix').value = '';
  for (let i = 0; i < comboListCount; i++) {
    const textarea = document.getElementById(`combo-list-${i}`);
    const delim = document.getElementById(`combo-delim-${i}`);
    if (textarea) textarea.value = '';
    if (delim) delim.value = '';
  }
  updateComboCounts();
}

function executeCombination(input) {
  const prefix = document.getElementById('combo-prefix').value.replace(/\\x/g, '\n');
  const suffix = document.getElementById('combo-suffix').value.replace(/\\x/g, '\n');
  
  // ãƒªã‚¹ãƒˆã‚’åé›†
  const lists = [];
  const delimiters = [];
  
  for (let i = 0; i < comboListCount; i++) {
    const textarea = document.getElementById(`combo-list-${i}`);
    if (textarea) {
      const lines = textarea.value.split('\n').filter(line => line.trim() !== '');
      if (lines.length > 0) {
        lists.push(lines);
        // åŒºåˆ‡ã‚Šæ–‡å­—ã‚’å–å¾—ï¼ˆ\xã‚’æ”¹è¡Œã«å¤‰æ›ï¼‰
        const delimInput = document.getElementById(`combo-delim-${i}`);
        if (delimInput) {
          delimiters.push(delimInput.value.replace(/\\x/g, '\n'));
        }
      }
    }
  }
  
  if (lists.length === 0) {
    document.getElementById('combination-count').textContent = '0 çµ„ã¿åˆã‚ã›';
    return '';
  }
  
  // çµ„ã¿åˆã‚ã›æ•°ã‚’è¨ˆç®—
  const totalCombinations = lists.reduce((acc, list) => acc * list.length, 1);
  document.getElementById('combination-count').textContent = `${totalCombinations.toLocaleString()} çµ„ã¿åˆã‚ã›ç”Ÿæˆ`;
  
  // è­¦å‘Šï¼ˆå¤§é‡ã®çµ„ã¿åˆã‚ã›ï¼‰
  if (totalCombinations > 100000) {
    if (!confirm(`${totalCombinations.toLocaleString()} ä»¶ã®çµ„ã¿åˆã‚ã›ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚ç¶šè¡Œã—ã¾ã™ã‹ï¼Ÿ`)) {
      return '';
    }
  }
  
  // å…¨çµ„ã¿åˆã‚ã›ã‚’ç”Ÿæˆ
  function generateCombinations(lists, delimiters) {
    if (lists.length === 0) return [''];
    if (lists.length === 1) return lists[0];
    
    const result = [];
    const [first, ...rest] = lists;
    const [firstDelim, ...restDelims] = delimiters;
    const restCombinations = generateCombinations(rest, restDelims);
    
    for (const item of first) {
      for (const combo of restCombinations) {
        result.push(item + (firstDelim || '') + combo);
      }
    }
    return result;
  }
  
  const combinations = generateCombinations(lists, delimiters);
  return combinations.map(combo => prefix + combo + suffix).join('\n');
}

// åˆæœŸåŒ–æ™‚ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
document.addEventListener('DOMContentLoaded', function() {
  for (let i = 0; i < comboListCount; i++) {
    const textarea = document.getElementById(`combo-list-${i}`);
    if (textarea) {
      textarea.addEventListener('input', updateComboCounts);
    }
  }
});

// Remove spaces
function executeRemoveSpaces(input) {
  const trim = document.getElementById('spaces-trim').checked;
  const mode = document.querySelector('input[name="spaces-remove-mode"]:checked').value;
  
  let lines = input.split('\n');
  
  lines = lines.map(line => {
    // ãƒˆãƒªãƒ 
    if (trim) {
      line = line.trim();
    }
    
    // ç©ºç™½å‰Šé™¤ãƒ¢ãƒ¼ãƒ‰
    if (mode === 'extra') {
      // é€£ç¶šã™ã‚‹ç©ºç™½ã‚’1ã¤ã«ï¼ˆåŠè§’ãƒ»å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ã€ã‚¿ãƒ–ï¼‰
      line = line.replace(/[ ã€€\t]+/g, ' ');
    } else if (mode === 'all') {
      // ã™ã¹ã¦ã®ç©ºç™½ã‚’å‰Šé™¤
      line = line.replace(/[ ã€€\t]/g, '');
    }
    
    return line;
  });
  
  return lines.join('\n');
}

// Add spaces (å®Ÿè¡Œãƒœã‚¿ãƒ³ã‹ã‚‰å‘¼ã³å‡ºã—ç”¨)
function executeAddSpacesMain(input) {
  const addEveryN = document.getElementById('spaces-add-every-n').checked;
  const addAfterChar = document.getElementById('spaces-add-after-char').checked;
  const addAfterLine = document.getElementById('spaces-add-after-line').checked;
  
  let output = input;
  
  // æŒ‡å®šæ–‡å­—ã®å¾Œã«ç©ºç™½ã‚’è¿½åŠ 
  if (addAfterChar) {
    const char = document.getElementById('spaces-after-char').value;
    if (char) {
      const escaped = char.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
      output = output.replace(new RegExp(escaped, 'g'), char + ' ');
    }
  }
  
  // Næ–‡å­—ã”ã¨ã«ç©ºç™½ã‚’è¿½åŠ 
  if (addEveryN) {
    const n = parseInt(document.getElementById('spaces-add-n').value) || 10;
    const lines = output.split('\n');
    output = lines.map(line => {
      let result = '';
      for (let i = 0; i < line.length; i += n) {
        result += line.substring(i, i + n);
        if (i + n < line.length) {
          result += ' ';
        }
      }
      return result;
    }).join('\n');
  }
  
  // å„è¡Œã®æœ«å°¾ã«ç©ºç™½ã‚’è¿½åŠ 
  if (addAfterLine) {
    output = output.split('\n').map(line => line + ' ').join('\n');
  }
  
  return output;
}

function executeRemoveSpacesOld(input) {
  // This function is no longer used
  return input;
}

// ============================================
// æ–‡å­—å¤‰æ›é–¢æ•°
// ============================================
function executeConvert(mode) {
  const input = document.getElementById('inputText').value;
  let output = input;
  
  switch(mode) {
    // å¤§æ–‡å­—/å°æ–‡å­—
    case 'lowercase':
      output = input.toLowerCase();
      break;
    case 'uppercase':
      output = input.toUpperCase();
      break;
    case 'randomcase':
      // ãƒ©ãƒ³ãƒ€ãƒ ã«å¤§æ–‡å­—/å°æ–‡å­—
      output = input.split('').map(c => Math.random() > 0.5 ? c.toUpperCase() : c.toLowerCase()).join('');
      break;
    case 'studlycaps':
      // äº¤äº’ã«å¤§æ–‡å­—/å°æ–‡å­—ï¼ˆStUdLy CaPsï¼‰
      let toggle = true;
      output = input.split('').map(c => {
        if (/[a-zA-Z]/.test(c)) {
          const result = toggle ? c.toUpperCase() : c.toLowerCase();
          toggle = !toggle;
          return result;
        }
        return c;
      }).join('');
      break;
    case 'capitalizeWords':
      // å„å˜èªã®å…ˆé ­ã‚’å¤§æ–‡å­—
      output = input.replace(/\b\w/g, c => c.toUpperCase());
      break;
    case 'uncapitalizeWords':
      // å„å˜èªã®å…ˆé ­ã‚’å°æ–‡å­—
      output = input.replace(/\b\w/g, c => c.toLowerCase());
      break;
    case 'capitalizeSentences':
      // å„æ–‡ã®å…ˆé ­ã‚’å¤§æ–‡å­—
      output = input.replace(/(^|[.!?ã€‚ï¼ï¼Ÿ]\s*)\w/g, c => c.toUpperCase());
      break;
    case 'uncapitalizeSentences':
      // å„æ–‡ã®å…ˆé ­ã‚’å°æ–‡å­—
      output = input.replace(/(^|[.!?ã€‚ï¼ï¼Ÿ]\s*)\w/g, c => c.toLowerCase());
      break;
    case 'snakeCase':
      // snake_case
      output = input
        .replace(/([a-z])([A-Z])/g, '$1_$2')
        .replace(/[\s\-]+/g, '_')
        .toLowerCase();
      break;
    case 'kebabCase':
      // kebab-case
      output = input
        .replace(/([a-z])([A-Z])/g, '$1-$2')
        .replace(/[\s_]+/g, '-')
        .toLowerCase();
      break;
    case 'camelCase':
      // camelCase
      output = input
        .replace(/[\s_\-]+(.)/g, (_, c) => c.toUpperCase())
        .replace(/^./, c => c.toLowerCase());
      break;
    case 'pascalCase':
      // PascalCase
      output = input
        .replace(/[\s_\-]+(.)/g, (_, c) => c.toUpperCase())
        .replace(/^./, c => c.toUpperCase());
      break;
    
    // å…¨è§’â†’åŠè§’
    case 'toFullwidth':
      output = toHalfWidth(input);
      break;
    // åŠè§’â†’å…¨è§’
    case 'toHalfwidth':
      output = toFullWidth(input);
      break;
    
    // åŠè§’ï¼‹ã²ã‚‰â†’å…¨è§’ãƒ»ã‚«ã‚¿ã‚«ãƒŠ
    case 'hiraToFullKata':
      output = toFullWidth(hiraganaToKatakana(input));
      break;
    // åŠè§’ï¼‹å…¨ã‚«ã‚¿â†’å…¨è§’ãƒ»ã²ã‚‰ãŒãª
    case 'hiraToHalfKata':
      output = toFullWidth(katakanaToHiragana(input));
      break;
    
    // å…¨è§’è‹±æ•°â†’åŠè§’è‹±æ•°
    case 'alphaToFull':
      output = fullAlphaNumToHalf(input);
      break;
    // åŠè§’è‹±æ•°â†’å…¨è§’è‹±æ•°
    case 'alphaToHalf':
      output = halfAlphaNumToFull(input);
      break;
    
    // å…¨è§’ã‚«ã‚¿ã‚«ãƒŠâ†’åŠè§’ã‚«ã‚¿ã‚«ãƒŠ
    case 'kataToFull':
      output = fullKatakanaToHalf(input);
      break;
    // åŠè§’ã‚«ã‚¿ã‚«ãƒŠâ†’å…¨è§’ã‚«ã‚¿ã‚«ãƒŠ
    case 'kataToHalf':
      output = halfKatakanaToFull(input);
      break;
    
    // ã²ã‚‰ãŒãªâ‡”ã‚«ã‚¿ã‚«ãƒŠ
    case 'hiraToKata':
      output = hiraganaToKatakana(input);
      break;
    case 'kataToHira':
      output = katakanaToHiragana(input);
      break;
    
    // TABâ‡”ç©ºç™½
    case 'tabToSpace': {
      const tabSpaces = parseInt(document.getElementById('convert-tab-spaces').value) || 4;
      output = input.replace(/\t/g, ' '.repeat(tabSpaces));
      break;
    }
    case 'spaceToTab': {
      const numSpaces = parseInt(document.getElementById('convert-tab-spaces').value) || 4;
      const spaceRegex = new RegExp(' {' + numSpaces + '}', 'g');
      output = input.replace(spaceRegex, '\t');
      break;
    }
  }
  
  document.getElementById('outputText').value = output;
  updateStats('outputText', 'output');
}

// å…¨è§’â†’åŠè§’å¤‰æ›
function toHalfWidth(str) {
  return str
    // å…¨è§’è‹±æ•°å­—â†’åŠè§’
    .replace(/[ï¼¡-ï¼ºï½-ï½šï¼-ï¼™]/g, s => String.fromCharCode(s.charCodeAt(0) - 0xFEE0))
    // å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹â†’åŠè§’
    .replace(/ã€€/g, ' ')
    // å…¨è§’è¨˜å·â†’åŠè§’
    .replace(/[ï¼-ï½]/g, s => String.fromCharCode(s.charCodeAt(0) - 0xFEE0));
}

// åŠè§’â†’å…¨è§’å¤‰æ›
function toFullWidth(str) {
  return str
    // åŠè§’è‹±æ•°å­—â†’å…¨è§’
    .replace(/[A-Za-z0-9]/g, s => String.fromCharCode(s.charCodeAt(0) + 0xFEE0))
    // åŠè§’ã‚¹ãƒšãƒ¼ã‚¹â†’å…¨è§’
    .replace(/ /g, 'ã€€')
    // åŠè§’è¨˜å·â†’å…¨è§’
    .replace(/[!-~]/g, s => String.fromCharCode(s.charCodeAt(0) + 0xFEE0));
}

// ã²ã‚‰ãŒãªâ†’ã‚«ã‚¿ã‚«ãƒŠ
function hiraganaToKatakana(str) {
  return str.replace(/[\u3041-\u3096]/g, s => String.fromCharCode(s.charCodeAt(0) + 0x60));
}

// ã‚«ã‚¿ã‚«ãƒŠâ†’ã²ã‚‰ãŒãª
function katakanaToHiragana(str) {
  return str.replace(/[\u30A1-\u30F6]/g, s => String.fromCharCode(s.charCodeAt(0) - 0x60));
}

// å…¨è§’è‹±æ•°â†’åŠè§’è‹±æ•°
function fullAlphaNumToHalf(str) {
  return str.replace(/[ï¼¡-ï¼ºï½-ï½šï¼-ï¼™]/g, s => String.fromCharCode(s.charCodeAt(0) - 0xFEE0));
}

// åŠè§’è‹±æ•°â†’å…¨è§’è‹±æ•°
function halfAlphaNumToFull(str) {
  return str.replace(/[A-Za-z0-9]/g, s => String.fromCharCode(s.charCodeAt(0) + 0xFEE0));
}

// å…¨è§’ã‚«ã‚¿ã‚«ãƒŠâ†’åŠè§’ã‚«ã‚¿ã‚«ãƒŠ
function fullKatakanaToHalf(str) {
  const kanaMap = {
    'ã‚¢': 'ï½±', 'ã‚¤': 'ï½²', 'ã‚¦': 'ï½³', 'ã‚¨': 'ï½´', 'ã‚ª': 'ï½µ',
    'ã‚«': 'ï½¶', 'ã‚­': 'ï½·', 'ã‚¯': 'ï½¸', 'ã‚±': 'ï½¹', 'ã‚³': 'ï½º',
    'ã‚µ': 'ï½»', 'ã‚·': 'ï½¼', 'ã‚¹': 'ï½½', 'ã‚»': 'ï½¾', 'ã‚½': 'ï½¿',
    'ã‚¿': 'ï¾€', 'ãƒ': 'ï¾', 'ãƒ„': 'ï¾‚', 'ãƒ†': 'ï¾ƒ', 'ãƒˆ': 'ï¾„',
    'ãƒŠ': 'ï¾…', 'ãƒ‹': 'ï¾†', 'ãƒŒ': 'ï¾‡', 'ãƒ': 'ï¾ˆ', 'ãƒ': 'ï¾‰',
    'ãƒ': 'ï¾Š', 'ãƒ’': 'ï¾‹', 'ãƒ•': 'ï¾Œ', 'ãƒ˜': 'ï¾', 'ãƒ›': 'ï¾',
    'ãƒ': 'ï¾', 'ãƒŸ': 'ï¾', 'ãƒ ': 'ï¾‘', 'ãƒ¡': 'ï¾’', 'ãƒ¢': 'ï¾“',
    'ãƒ¤': 'ï¾”', 'ãƒ¦': 'ï¾•', 'ãƒ¨': 'ï¾–',
    'ãƒ©': 'ï¾—', 'ãƒª': 'ï¾˜', 'ãƒ«': 'ï¾™', 'ãƒ¬': 'ï¾š', 'ãƒ­': 'ï¾›',
    'ãƒ¯': 'ï¾œ', 'ãƒ²': 'ï½¦', 'ãƒ³': 'ï¾',
    'ã‚¡': 'ï½§', 'ã‚£': 'ï½¨', 'ã‚¥': 'ï½©', 'ã‚§': 'ï½ª', 'ã‚©': 'ï½«',
    'ãƒƒ': 'ï½¯', 'ãƒ£': 'ï½¬', 'ãƒ¥': 'ï½­', 'ãƒ§': 'ï½®',
    'ã‚¬': 'ï½¶ï¾', 'ã‚®': 'ï½·ï¾', 'ã‚°': 'ï½¸ï¾', 'ã‚²': 'ï½¹ï¾', 'ã‚´': 'ï½ºï¾',
    'ã‚¶': 'ï½»ï¾', 'ã‚¸': 'ï½¼ï¾', 'ã‚º': 'ï½½ï¾', 'ã‚¼': 'ï½¾ï¾', 'ã‚¾': 'ï½¿ï¾',
    'ãƒ€': 'ï¾€ï¾', 'ãƒ‚': 'ï¾ï¾', 'ãƒ…': 'ï¾‚ï¾', 'ãƒ‡': 'ï¾ƒï¾', 'ãƒ‰': 'ï¾„ï¾',
    'ãƒ': 'ï¾Šï¾', 'ãƒ“': 'ï¾‹ï¾', 'ãƒ–': 'ï¾Œï¾', 'ãƒ™': 'ï¾ï¾', 'ãƒœ': 'ï¾ï¾',
    'ãƒ‘': 'ï¾Šï¾Ÿ', 'ãƒ”': 'ï¾‹ï¾Ÿ', 'ãƒ—': 'ï¾Œï¾Ÿ', 'ãƒš': 'ï¾ï¾Ÿ', 'ãƒ': 'ï¾ï¾Ÿ',
    'ãƒ´': 'ï½³ï¾', 'ãƒ¼': 'ï½°', 'ã€‚': 'ï½¡', 'ã€': 'ï½¤', 'ã€Œ': 'ï½¢', 'ã€': 'ï½£'
  };
  return str.replace(/[ã‚¢-ãƒ´ãƒ¼ã€‚ã€ã€Œã€]/g, s => kanaMap[s] || s);
}

// åŠè§’ã‚«ã‚¿ã‚«ãƒŠâ†’å…¨è§’ã‚«ã‚¿ã‚«ãƒŠ
function halfKatakanaToFull(str) {
  const kanaMap = {
    'ï½±': 'ã‚¢', 'ï½²': 'ã‚¤', 'ï½³': 'ã‚¦', 'ï½´': 'ã‚¨', 'ï½µ': 'ã‚ª',
    'ï½¶': 'ã‚«', 'ï½·': 'ã‚­', 'ï½¸': 'ã‚¯', 'ï½¹': 'ã‚±', 'ï½º': 'ã‚³',
    'ï½»': 'ã‚µ', 'ï½¼': 'ã‚·', 'ï½½': 'ã‚¹', 'ï½¾': 'ã‚»', 'ï½¿': 'ã‚½',
    'ï¾€': 'ã‚¿', 'ï¾': 'ãƒ', 'ï¾‚': 'ãƒ„', 'ï¾ƒ': 'ãƒ†', 'ï¾„': 'ãƒˆ',
    'ï¾…': 'ãƒŠ', 'ï¾†': 'ãƒ‹', 'ï¾‡': 'ãƒŒ', 'ï¾ˆ': 'ãƒ', 'ï¾‰': 'ãƒ',
    'ï¾Š': 'ãƒ', 'ï¾‹': 'ãƒ’', 'ï¾Œ': 'ãƒ•', 'ï¾': 'ãƒ˜', 'ï¾': 'ãƒ›',
    'ï¾': 'ãƒ', 'ï¾': 'ãƒŸ', 'ï¾‘': 'ãƒ ', 'ï¾’': 'ãƒ¡', 'ï¾“': 'ãƒ¢',
    'ï¾”': 'ãƒ¤', 'ï¾•': 'ãƒ¦', 'ï¾–': 'ãƒ¨',
    'ï¾—': 'ãƒ©', 'ï¾˜': 'ãƒª', 'ï¾™': 'ãƒ«', 'ï¾š': 'ãƒ¬', 'ï¾›': 'ãƒ­',
    'ï¾œ': 'ãƒ¯', 'ï½¦': 'ãƒ²', 'ï¾': 'ãƒ³',
    'ï½§': 'ã‚¡', 'ï½¨': 'ã‚£', 'ï½©': 'ã‚¥', 'ï½ª': 'ã‚§', 'ï½«': 'ã‚©',
    'ï½¯': 'ãƒƒ', 'ï½¬': 'ãƒ£', 'ï½­': 'ãƒ¥', 'ï½®': 'ãƒ§',
    'ï½°': 'ãƒ¼', 'ï½¡': 'ã€‚', 'ï½¤': 'ã€', 'ï½¢': 'ã€Œ', 'ï½£': 'ã€'
  };
  // æ¿ç‚¹ãƒ»åŠæ¿ç‚¹ã®å‡¦ç†
  return str
    .replace(/ï½¶ï¾/g, 'ã‚¬').replace(/ï½·ï¾/g, 'ã‚®').replace(/ï½¸ï¾/g, 'ã‚°').replace(/ï½¹ï¾/g, 'ã‚²').replace(/ï½ºï¾/g, 'ã‚´')
    .replace(/ï½»ï¾/g, 'ã‚¶').replace(/ï½¼ï¾/g, 'ã‚¸').replace(/ï½½ï¾/g, 'ã‚º').replace(/ï½¾ï¾/g, 'ã‚¼').replace(/ï½¿ï¾/g, 'ã‚¾')
    .replace(/ï¾€ï¾/g, 'ãƒ€').replace(/ï¾ï¾/g, 'ãƒ‚').replace(/ï¾‚ï¾/g, 'ãƒ…').replace(/ï¾ƒï¾/g, 'ãƒ‡').replace(/ï¾„ï¾/g, 'ãƒ‰')
    .replace(/ï¾Šï¾/g, 'ãƒ').replace(/ï¾‹ï¾/g, 'ãƒ“').replace(/ï¾Œï¾/g, 'ãƒ–').replace(/ï¾ï¾/g, 'ãƒ™').replace(/ï¾ï¾/g, 'ãƒœ')
    .replace(/ï¾Šï¾Ÿ/g, 'ãƒ‘').replace(/ï¾‹ï¾Ÿ/g, 'ãƒ”').replace(/ï¾Œï¾Ÿ/g, 'ãƒ—').replace(/ï¾ï¾Ÿ/g, 'ãƒš').replace(/ï¾ï¾Ÿ/g, 'ãƒ')
    .replace(/ï½³ï¾/g, 'ãƒ´')
    .replace(/[ï½±-ï¾ï½§-ï½®ï½°ï½¡ï½¤ï½¢ï½£]/g, s => kanaMap[s] || s);
}

// ============================================
// è¡Œæ“ä½œé–¢æ•°
// ============================================
function executeLineOps(mode) {
  const input = document.getElementById('inputText').value;
  let lines = input.split('\n');
  let output = '';
  
  switch(mode) {
    case 'trimLeft':
      output = lines.map(line => line.replace(/^[\sã€€]+/, '')).join('\n');
      break;
    case 'trimRight':
      output = lines.map(line => line.replace(/[\sã€€]+$/, '')).join('\n');
      break;
    
    // ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½
    case 'sortAlpha':
    case 'sortAlphaCase':
    case 'sortNatural':
    case 'sortNaturalCase':
    case 'sortLength':
    case 'sortRandom':
    case 'sortReverse':
    case 'sortAsc':
    case 'sortDesc': {
      const delimiter = document.getElementById('sort-delimiter').value;
      const colNum = parseInt(document.getElementById('sort-column').value) - 1 || 0;
      const desc = document.getElementById('sort-desc').checked;
      
      // ã‚½ãƒ¼ãƒˆç”¨ã®ã‚­ãƒ¼ã‚’å–å¾—ã™ã‚‹é–¢æ•°
      const getKey = (line) => {
        if (delimiter) {
          const parts = line.split(delimiter);
          return parts[colNum] !== undefined ? parts[colNum] : line;
        }
        return line;
      };
      
      let sortFn;
      
      switch (mode) {
        case 'sortAlpha':
        case 'sortAsc':
          // ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ï¼ˆå¤§æ–‡å­—å°æ–‡å­—åŒºåˆ¥ãªã—ï¼‰
          sortFn = (a, b) => getKey(a).localeCompare(getKey(b), 'ja', { sensitivity: 'base' });
          break;
        case 'sortAlphaCase':
          // ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ï¼ˆå¤§æ–‡å­—å°æ–‡å­—åŒºåˆ¥ã‚ã‚Šï¼‰- ASCIIé †
          sortFn = (a, b) => {
            const keyA = getKey(a), keyB = getKey(b);
            return keyA < keyB ? -1 : keyA > keyB ? 1 : 0;
          };
          break;
        case 'sortNatural':
          // è‡ªç„¶é †ã‚½ãƒ¼ãƒˆï¼ˆå¤§æ–‡å­—å°æ–‡å­—åŒºåˆ¥ãªã—ï¼‰- æ•°å­—ã‚’æ•°å€¤ã¨ã—ã¦æ‰±ã†
          sortFn = (a, b) => getKey(a).localeCompare(getKey(b), 'ja', { numeric: true, sensitivity: 'base' });
          break;
        case 'sortNaturalCase':
          // è‡ªç„¶é †ã‚½ãƒ¼ãƒˆï¼ˆå¤§æ–‡å­—å°æ–‡å­—åŒºåˆ¥ã‚ã‚Šï¼‰- æ•°å­—ã‚’æ•°å€¤ã¨ã—ã¦æ‰±ã„ã€ASCIIé †
          sortFn = (a, b) => {
            const keyA = getKey(a), keyB = getKey(b);
            const re = /(\d+)|(\D+)/g;
            const aParts = keyA.match(re) || [];
            const bParts = keyB.match(re) || [];
            
            for (let i = 0; i < Math.max(aParts.length, bParts.length); i++) {
              const aPart = aParts[i] || '';
              const bPart = bParts[i] || '';
              
              const aNum = parseInt(aPart);
              const bNum = parseInt(bPart);
              
              if (!isNaN(aNum) && !isNaN(bNum)) {
                if (aNum !== bNum) return aNum - bNum;
              } else {
                if (aPart !== bPart) return aPart < bPart ? -1 : 1;
              }
            }
            return 0;
          };
          break;
        case 'sortLength':
          // æ–‡å­—æ•°é †
          sortFn = (a, b) => getKey(a).length - getKey(b).length;
          break;
        case 'sortRandom':
          // ãƒ©ãƒ³ãƒ€ãƒ 
          sortFn = () => Math.random() - 0.5;
          break;
        case 'sortReverse':
          // é€†é †ï¼ˆç¾åœ¨ã®é †åºã‚’åè»¢ï¼‰
          output = lines.reverse().join('\n');
          break;
        case 'sortDesc':
          // é™é †ï¼ˆå¾Œæ–¹äº’æ›ï¼‰
          sortFn = (a, b) => getKey(b).localeCompare(getKey(a), 'ja', { numeric: true });
          break;
      }
      
      if (mode !== 'sortReverse') {
        lines.sort(sortFn);
        // é™é †ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒONã®å ´åˆã¯çµæœã‚’åè»¢ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ä»¥å¤–ï¼‰
        if (desc && mode !== 'sortRandom') {
          lines.reverse();
        }
        output = lines.join('\n');
      }
      break;
    }
    
    case 'uniq':
      // é€£ç¶šã—ãŸé‡è¤‡è¡Œã®ã¿å‰Šé™¤ï¼ˆunixã®uniqã‚³ãƒãƒ³ãƒ‰ã¨åŒæ§˜ï¼‰
      output = lines.filter((line, i) => i === 0 || line !== lines[i - 1]).join('\n');
      break;
    case 'combine': {
      // è¡Œçµåˆ
      const delimiter = document.getElementById('combine-delimiter').value;
      const skipEmpty = document.getElementById('combine-skip-empty').checked;
      let targetLines = lines;
      if (skipEmpty) {
        targetLines = lines.filter(line => line.trim() !== '');
      }
      output = targetLines.join(delimiter);
      break;
    }
    case 'removeEmpty': {
      // ç©ºè¡Œå‰Šé™¤
      const removeWhitespaceOnly = document.getElementById('empty-whitespace').checked;
      if (removeWhitespaceOnly) {
        output = lines.filter(line => line.trim() !== '').join('\n');
      } else {
        output = lines.filter(line => line !== '').join('\n');
      }
      break;
    }
    case 'filterContaining':
    case 'filterNotContaining': {
      // æŒ‡å®šæ–‡å­—åˆ—ã‚’å«ã‚€/å«ã¾ãªã„è¡Œã‚’å‰Šé™¤
      const filterText = document.getElementById('filter-text').value;
      const caseSensitive = document.getElementById('filter-case').checked;
      const useRegex = document.getElementById('filter-regex').checked;
      const showRemoved = document.getElementById('filter-show-removed').checked;
      const countDiv = document.getElementById('filter-removed-count');
      const isContaining = (mode === 'filterContaining');
      
      if (!filterText) {
        output = input;
        countDiv.textContent = 'æ¤œç´¢æ–‡å­—åˆ—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';
        break;
      }
      
      let matcher;
      try {
        if (useRegex) {
          const flags = caseSensitive ? 'g' : 'gi';
          matcher = new RegExp(filterText, flags);
        } else {
          const escaped = filterText.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
          const flags = caseSensitive ? '' : 'i';
          matcher = new RegExp(escaped, flags);
        }
      } catch (e) {
        output = input;
        countDiv.textContent = 'æ­£è¦è¡¨ç¾ã‚¨ãƒ©ãƒ¼: ' + e.message;
        break;
      }
      
      const kept = [];
      const removed = [];
      
      for (const line of lines) {
        const matches = matcher.test(line);
        // Reset lastIndex for global regex
        matcher.lastIndex = 0;
        
        // filterContaining: å«ã‚€è¡Œã‚’å‰Šé™¤ â†’ ãƒãƒƒãƒã—ãŸã‚‰å‰Šé™¤
        // filterNotContaining: å«ã¾ãªã„è¡Œã‚’å‰Šé™¤ â†’ ãƒãƒƒãƒã—ãªã‹ã£ãŸã‚‰å‰Šé™¤
        const shouldRemove = isContaining ? matches : !matches;
        
        if (shouldRemove) {
          removed.push(line);
        } else {
          kept.push(line);
        }
      }
      
      output = kept.join('\n');
      
      // å‰Šé™¤ã•ã‚ŒãŸè¡Œæ•°ã‚’è¡¨ç¤º
      const modeText = isContaining ? 'å«ã‚€' : 'å«ã¾ãªã„';
      countDiv.textContent = `${removed.length} è¡Œã‚’å‰Šé™¤ã—ã¾ã—ãŸï¼ˆ"${filterText}" ã‚’${modeText}è¡Œï¼‰`;
      
      // å‰Šé™¤ã•ã‚ŒãŸè¡Œã‚’è¡¨ç¤ºã™ã‚‹å ´åˆ
      if (showRemoved && removed.length > 0) {
        output += '\n\n--- å‰Šé™¤ã•ã‚ŒãŸè¡Œ (' + removed.length + 'è¡Œ) ---\n' + removed.join('\n');
      }
      break;
    }
    case 'removeDuplicates': {
      // ã™ã¹ã¦ã®é‡è¤‡è¡Œã‚’å‰Šé™¤
      const caseSensitive = document.getElementById('dup-case').checked;
      const trim = document.getElementById('dup-trim').checked;
      const keepOrder = document.getElementById('dup-keep-order').checked;
      const seen = new Set();
      const result = [];
      
      for (const line of lines) {
        let key = trim ? line.trim() : line;
        if (!caseSensitive) key = key.toLowerCase();
        
        if (!seen.has(key)) {
          seen.add(key);
          result.push(line);
        }
      }
      
      if (!keepOrder) {
        result.sort((a, b) => a.localeCompare(b, 'ja'));
      }
      
      output = result.join('\n');
      break;
    }
    case 'repeat': {
      // ç¹°ã‚Šè¿”ã—ç”Ÿæˆ
      const repeatCount = parseInt(document.getElementById('repeat-count').value) || 10;
      const perRow = parseInt(document.getElementById('repeat-per-row').value) || 1;
      const separator = document.getElementById('repeat-separator').value;
      const eachLine = document.getElementById('repeat-each-line').checked;
      
      if (eachLine) {
        // å„è¡Œã‚’å€‹åˆ¥ã«ç¹°ã‚Šè¿”ã™
        const resultLines = [];
        for (const line of lines) {
          if (line.trim() === '') {
            resultLines.push(line);
            continue;
          }
          const repeated = [];
          for (let i = 0; i < repeatCount; i++) {
            repeated.push(line);
          }
          // perRowã”ã¨ã«è¡Œã‚’åˆ†å‰²
          const chunks = [];
          for (let i = 0; i < repeated.length; i += perRow) {
            chunks.push(repeated.slice(i, i + perRow).join(separator));
          }
          resultLines.push(chunks.join('\n'));
        }
        output = resultLines.join('\n');
      } else {
        // å…¥åŠ›å…¨ä½“ã‚’1ã¤ã®ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦ç¹°ã‚Šè¿”ã™
        const text = input;
        const repeated = [];
        for (let i = 0; i < repeatCount; i++) {
          repeated.push(text);
        }
        // perRowã”ã¨ã«è¡Œã‚’åˆ†å‰²
        const chunks = [];
        for (let i = 0; i < repeated.length; i += perRow) {
          chunks.push(repeated.slice(i, i + perRow).join(separator));
        }
        output = chunks.join('\n');
      }
      break;
    }
  }
  
  document.getElementById('outputText').value = output;
  updateStats('outputText', 'output');
}

// Utilities
function clearAll() {
  document.getElementById('inputText').value = '';
  document.getElementById('outputText').value = '';
  updateStats('inputText', 'input');
  updateStats('outputText', 'output');
}

function swapTexts() {
  const input = document.getElementById('inputText');
  const output = document.getElementById('outputText');
  const temp = input.value;
  input.value = output.value;
  output.value = temp;
  updateStats('inputText', 'input');
  updateStats('outputText', 'output');
}

function sortInput(order) {
  const textarea = document.getElementById('inputText');
  const lines = textarea.value.split('\n');
  lines.sort((a, b) => {
    const result = a.localeCompare(b, 'ja');
    return order === 'asc' ? result : -result;
  });
  textarea.value = lines.join('\n');
  updateStats('inputText', 'input');
}

async function copyToClipboard() {
  const text = document.getElementById('outputText').value;
  await navigator.clipboard.writeText(text);
}

function downloadOutput() {
  const text = document.getElementById('outputText').value;
  const blob = new Blob([text], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  const now = new Date();
  const timestamp = now.toISOString().slice(0, 19).replace(/[-:]/g, '').replace('T', '_');
  a.href = url;
  a.download = `TextTools_${timestamp}.txt`;
  a.click();
  URL.revokeObjectURL(url);
}

// Keyboard shortcut
document.addEventListener('keydown', (e) => {
  if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
    e.preventDefault();
    execute();
  }
});

// Initial stats
updateStats('inputText', 'input');
updateStats('outputText', 'output');

// ============================================
// ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿æ©Ÿèƒ½ï¼ˆSJIS/EUC-JP/UTF-8è‡ªå‹•åˆ¤åˆ¥ï¼‰
// ============================================

const MAX_FILE_SIZE = 1 * 1024 * 1024; // 1MB
const WARN_FILE_SIZE = 500 * 1024; // 500KB

const DEFAULT_EXTENSIONS = [
  '.txt', '.md', '.html', '.htm', '.xht', '.xhtml', 
  '.css', '.js', '.json', '.xml', '.csv', '.tsv',
  '.java', '.properties', '.gradle', '.kt', '.scala', '.groovy', 
  '.yml', '.yaml', '.pom', '.log', '.ini', '.conf'
];

function getAllowedExtensions() {
  const urlParams = new URLSearchParams(window.location.search);
  const extraExts = urlParams.get('ext');
  const allowed = [...DEFAULT_EXTENSIONS];
  if (extraExts) {
    extraExts.split(',').forEach(ext => {
      const e = ext.startsWith('.') ? ext : '.' + ext;
      if (!allowed.includes(e.toLowerCase())) {
        allowed.push(e.toLowerCase());
      }
    });
  }
  return allowed;
}

function getFileExtension(filename) {
  const lastDot = filename.lastIndexOf('.');
  return lastDot >= 0 ? filename.slice(lastDot).toLowerCase() : '';
}

function checkFileType(file) {
  const ext = getFileExtension(file.name);
  const allowed = getAllowedExtensions();
  
  if (!ext) {
    return confirm('æ‹¡å¼µå­ã®ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦èª­ã¿è¾¼ã¿ã¾ã™ã‹ï¼Ÿ');
  }
  
  if (!allowed.includes(ext)) {
    const proceed = confirm(
      `æœªå¯¾å¿œã®å½¢å¼ã§ã™ï¼ˆ${ext}ï¼‰ã€‚\n\nãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦èª­ã¿è¾¼ã¿ã¾ã™ã‹ï¼Ÿ\n\n` +
      `OKã‚’æŠ¼ã™ã¨ã€ã“ã®URLã§ã¯æ¬¡å›ã‹ã‚‰ç¢ºèªãªã—ã§èª­ã¿è¾¼ã‚ã¾ã™ã€‚`
    );
    if (proceed) {
      addExtensionToUrl(ext);
    }
    return proceed;
  }
  return true;
}

function addExtensionToUrl(ext) {
  const url = new URL(window.location);
  const currentExts = url.searchParams.get('ext');
  const extWithoutDot = ext.startsWith('.') ? ext.slice(1) : ext;
  
  if (currentExts) {
    const extList = currentExts.split(',');
    if (!extList.includes(extWithoutDot)) {
      extList.push(extWithoutDot);
      url.searchParams.set('ext', extList.join(','));
    }
  } else {
    url.searchParams.set('ext', extWithoutDot);
  }
  window.history.replaceState({}, '', url);
}

function checkFileSize(file) {
  if (file.size > MAX_FILE_SIZE) {
    alert(`ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤§ãã™ãã¾ã™ï¼ˆ${formatFileSize(file.size)}ï¼‰ã€‚\n1MBä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚`);
    return false;
  }
  if (file.size > WARN_FILE_SIZE) {
    return confirm(`ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã„ã§ã™ï¼ˆ${formatFileSize(file.size)}ï¼‰ã€‚\nå‡¦ç†ã«æ™‚é–“ãŒã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ç¶šè¡Œã—ã¾ã™ã‹ï¼Ÿ`);
  }
  return true;
}

function formatFileSize(bytes) {
  if (bytes < 1024) return bytes + ' B';
  if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
  return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
}

// ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã«ã‚»ãƒƒãƒˆï¼ˆSJIS/EUC-JP/UTF-8è‡ªå‹•åˆ¤åˆ¥ï¼‰
function readFile(file, textareaId) {
  const reader = new FileReader();
  reader.onload = (e) => {
    const arrayBuffer = e.target.result;
    const uint8Array = new Uint8Array(arrayBuffer);
    
    // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’è‡ªå‹•æ¤œå‡º
    const detectedEncoding = Encoding.detect(uint8Array);
    
    // Unicodeé…åˆ—ã«å¤‰æ›
    const unicodeArray = Encoding.convert(uint8Array, {
      to: 'UNICODE',
      from: detectedEncoding
    });
    
    // æ–‡å­—åˆ—ã«å¤‰æ›
    const text = Encoding.codeToString(unicodeArray);
    document.getElementById(textareaId).value = text;
    updateStats(textareaId, textareaId === 'inputText' ? 'input' : 'output');
  };
  reader.readAsArrayBuffer(file);
}

// ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
function setupDragDrop(panelId, textareaId) {
  const panel = document.getElementById(panelId);
  const textarea = document.getElementById(textareaId);
  
  if (!panel || !textarea) return;
  
  ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
    panel.addEventListener(eventName, (e) => {
      e.preventDefault();
      e.stopPropagation();
    });
  });
  
  ['dragenter', 'dragover'].forEach(eventName => {
    panel.addEventListener(eventName, () => {
      panel.classList.add('drag-over');
    });
  });
  
  ['dragleave', 'drop'].forEach(eventName => {
    panel.addEventListener(eventName, () => {
      panel.classList.remove('drag-over');
    });
  });
  
  panel.addEventListener('drop', (e) => {
    const files = e.dataTransfer.files;
    if (files.length > 0) {
      const file = files[0];
      if (checkFileSize(file) && checkFileType(file)) {
        readFile(file, textareaId);
      }
    }
  });
  
  // ãƒ•ã‚¡ã‚¤ãƒ«ãƒšãƒ¼ã‚¹ãƒˆå¯¾å¿œ
  textarea.addEventListener('paste', (e) => {
    const items = e.clipboardData.items;
    for (const item of items) {
      if (item.kind === 'file') {
        e.preventDefault();
        const file = item.getAsFile();
        if (file && checkFileSize(file) && checkFileType(file)) {
          readFile(file, textareaId);
        }
        return;
      }
    }
  });
}

// ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—åˆæœŸåŒ–
setupDragDrop('inputPanel', 'inputText');

// ============================================
// ãƒ†ã‚¹ãƒˆé–¢æ•° - ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ runAllTests() ã‚’å®Ÿè¡Œ
// ============================================
function runAllTests() {
  console.log('========================================');
  console.log('TextTools å…¨æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆé–‹å§‹');
  console.log('========================================');
  
  let passed = 0;
  let failed = 0;
  
  function test(name, fn) {
    try {
      const result = fn();
      if (result === true) {
        console.log(`âœ… PASS: ${name}`);
        passed++;
      } else {
        console.log(`âŒ FAIL: ${name} - çµæœ: ${result}`);
        failed++;
      }
    } catch (e) {
      console.log(`âŒ ERROR: ${name} - ${e.message}`);
      failed++;
    }
  }
  
  // 1. è¡Œé ­/è¡Œæœ«è¿½åŠ 
  test('è¡Œé ­/è¡Œæœ«è¿½åŠ  - Prefixè¿½åŠ ', () => {
    document.getElementById('prefix-text').value = '> ';
    document.getElementById('suffix-text').value = '';
    document.getElementById('prefix-skip-empty').checked = false;
    const result = executePrefixSuffix('line1\nline2\nline3');
    return result === '> line1\n> line2\n> line3';
  });
  
  test('è¡Œé ­/è¡Œæœ«è¿½åŠ  - Suffixè¿½åŠ ', () => {
    document.getElementById('prefix-text').value = '';
    document.getElementById('suffix-text').value = '!';
    const result = executePrefixSuffix('a\nb\nc');
    return result === 'a!\nb!\nc!';
  });
  
  test('è¡Œé ­/è¡Œæœ«è¿½åŠ  - Prefix+SuffixåŒæ™‚', () => {
    document.getElementById('prefix-text').value = '[';
    document.getElementById('suffix-text').value = ']';
    document.getElementById('prefix-skip-empty').checked = false;
    const result = executePrefixSuffix('a\nb');
    return result === '[a]\n[b]';
  });
  
  test('è¡Œé ­/è¡Œæœ«è¿½åŠ  - ç©ºè¡Œã‚¹ã‚­ãƒƒãƒ—ON', () => {
    document.getElementById('prefix-text').value = '- ';
    document.getElementById('suffix-text').value = '';
    document.getElementById('prefix-skip-empty').checked = true;
    const result = executePrefixSuffix('a\n\nb');
    return result === '- a\n\n- b';
  });
  
  test('è¡Œé ­/è¡Œæœ«è¿½åŠ  - ç©ºè¡Œã‚¹ã‚­ãƒƒãƒ—OFF', () => {
    document.getElementById('prefix-text').value = '- ';
    document.getElementById('suffix-text').value = '';
    document.getElementById('prefix-skip-empty').checked = false;
    const result = executePrefixSuffix('a\n\nb');
    return result === '- a\n- \n- b';
  });
  
  // 2. æ”¹è¡Œè¿½åŠ /å‰Šé™¤
  test('æ”¹è¡Œå‰Šé™¤ - ã™ã¹ã¦å‰Šé™¤', () => {
    document.getElementById('inputText').value = 'a\nb\nc';
    document.getElementById('lb-remove-replace').value = '';
    executeLineBreakRemoveAll();
    return document.getElementById('outputText').value === 'abc';
  });
  
  test('æ”¹è¡Œå‰Šé™¤ - ã‚¹ãƒšãƒ¼ã‚¹ã§ç½®æ›', () => {
    document.getElementById('inputText').value = 'a\nb\nc';
    document.getElementById('lb-remove-replace').value = ' ';
    executeLineBreakRemoveAll();
    return document.getElementById('outputText').value === 'a b c';
  });
  
  test('æ”¹è¡Œå‰Šé™¤ - ã‚«ãƒ³ãƒã§ç½®æ›', () => {
    document.getElementById('inputText').value = 'a\nb\nc';
    document.getElementById('lb-remove-replace').value = ',';
    executeLineBreakRemoveAll();
    return document.getElementById('outputText').value === 'a,b,c';
  });
  
  test('æ”¹è¡Œè¿½åŠ  - æŒ‡å®šæ–‡å­—ã®å¾Œ', () => {
    document.getElementById('inputText').value = 'a.b.c';
    document.getElementById('lb-target-text').value = '.';
    document.querySelector('input[name="lb-position"][value="after"]').checked = true;
    document.getElementById('lb-case-sensitive').checked = false;
    document.getElementById('lb-remove-existing').checked = false;
    executeLineBreakAtText();
    return document.getElementById('outputText').value === 'a.\nb.\nc';
  });
  
  test('æ”¹è¡Œè¿½åŠ  - æŒ‡å®šæ–‡å­—ã®å‰', () => {
    document.getElementById('inputText').value = 'a.b.c';
    document.getElementById('lb-target-text').value = '.';
    document.querySelector('input[name="lb-position"][value="before"]').checked = true;
    document.getElementById('lb-case-sensitive').checked = false;
    document.getElementById('lb-remove-existing').checked = false;
    executeLineBreakAtText();
    return document.getElementById('outputText').value === 'a\n.b\n.c';
  });
  
  test('æ”¹è¡Œè¿½åŠ  - å¤§æ–‡å­—å°æ–‡å­—åŒºåˆ¥ON', () => {
    document.getElementById('inputText').value = 'aAbAa';
    document.getElementById('lb-target-text').value = 'A';
    document.querySelector('input[name="lb-position"][value="after"]').checked = true;
    document.getElementById('lb-case-sensitive').checked = true;
    document.getElementById('lb-remove-existing').checked = false;
    executeLineBreakAtText();
    return document.getElementById('outputText').value === 'aA\nbA\na';
  });
  
  test('æ”¹è¡Œè¿½åŠ  - Næ–‡å­—ã”ã¨', () => {
    document.getElementById('inputText').value = 'abcdefghij';
    document.getElementById('lb-every-n').value = '3';
    document.getElementById('lb-wordwrap').checked = false;
    document.getElementById('lb-escape-existing').checked = false;
    executeLineBreakEveryN();
    return document.getElementById('outputText').value === 'abc\ndef\nghi\nj';
  });
  
  test('æ”¹è¡Œè¿½åŠ  - Næ–‡å­—ã”ã¨ï¼ˆãƒ¯ãƒ¼ãƒ‰ãƒ©ãƒƒãƒ—ï¼‰', () => {
    document.getElementById('inputText').value = 'hello world test';
    document.getElementById('lb-every-n').value = '8';
    document.getElementById('lb-wordwrap').checked = true;
    document.getElementById('lb-escape-existing').checked = false;
    executeLineBreakEveryN();
    const output = document.getElementById('outputText').value;
    return output.includes('hello') && output.includes('\n');
  });
  
  test('æ”¹è¡Œè¿½åŠ  - Næ–‡å­—ã”ã¨ï¼ˆæ—¢å­˜æ”¹è¡Œã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ï¼‰', () => {
    document.getElementById('inputText').value = 'ab\ncd';
    document.getElementById('lb-every-n').value = '5';
    document.getElementById('lb-wordwrap').checked = false;
    document.getElementById('lb-escape-existing').checked = true;
    executeLineBreakEveryN();
    return document.getElementById('outputText').value === 'ab\\nc\nd';
  });
  
  test('æ”¹è¡Œè¿½åŠ  - å„è¡Œã®å¾Œã«ç©ºè¡Œ', () => {
    document.getElementById('inputText').value = 'a\nb';
    executeLineBreakAddAfterEach();
    return document.getElementById('outputText').value === 'a\n\nb';
  });
  
  test('æ”¹è¡Œè¿½åŠ  - å„è¡Œã®å‰ã«ç©ºè¡Œ', () => {
    document.getElementById('inputText').value = 'a\nb';
    executeLineBreakAddBeforeEach();
    return document.getElementById('outputText').value === 'a\n\nb';
  });
  
  test('æ”¹è¡Œè¿½åŠ  - é€£ç¶šç©ºè¡Œã‚’1ã¤ã«', () => {
    document.getElementById('inputText').value = 'a\n\n\nb\n\nc';
    executeLineBreakMergeMultiple();
    return document.getElementById('outputText').value === 'a\n\nb\n\nc';
  });
  
  // 3. æ–‡å­—ã‚«ã‚¦ãƒ³ãƒˆ
  test('æ–‡å­—ã‚«ã‚¦ãƒ³ãƒˆ - åŸºæœ¬', () => {
    document.getElementById('count-no-spaces').checked = false;
    document.getElementById('count-no-html').checked = false;
    document.getElementById('count-linebreak-space').checked = false;
    const result = executeCount('Hello World');
    return result.includes('11');
  });
  
  test('æ–‡å­—ã‚«ã‚¦ãƒ³ãƒˆ - ã‚¹ãƒšãƒ¼ã‚¹é™¤å¤–', () => {
    document.getElementById('count-no-spaces').checked = true;
    document.getElementById('count-no-html').checked = false;
    const result = executeCount('Hello World');
    return result.includes('10');
  });
  
  test('æ–‡å­—ã‚«ã‚¦ãƒ³ãƒˆ - HTMLã‚¿ã‚°é™¤å¤–', () => {
    document.getElementById('count-no-spaces').checked = false;
    document.getElementById('count-no-html').checked = true;
    const result = executeCount('<p>Hello</p>');
    return result.includes('5');
  });
  
  test('æ–‡å­—ã‚«ã‚¦ãƒ³ãƒˆ - æ”¹è¡Œã‚’ã‚¹ãƒšãƒ¼ã‚¹ã¨ã—ã¦', () => {
    document.getElementById('count-no-spaces').checked = false;
    document.getElementById('count-no-html').checked = false;
    document.getElementById('count-linebreak-space').checked = true;
    const result = executeCount('a\nb');
    return result.includes('3');
  });
  
  // 4. åˆ—æŠ½å‡º
  test('åˆ—æŠ½å‡º - ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š', () => {
    document.getElementById('inputText').value = 'a,b,c\n1,2,3';
    document.getElementById('column-delimiter-text').value = ',';
    document.getElementById('column-count').value = '3';
    document.getElementById('column-row-delimiter').value = '\\n';
    document.getElementById('column-remove-empty').checked = false;
    document.getElementById('column-trim').checked = false;
    executeColumnExtractMulti();
    const col1 = document.getElementById('col-output-0').value;
    return col1 === 'a\n1';
  });
  
  test('åˆ—æŠ½å‡º - ã‚¿ãƒ–åŒºåˆ‡ã‚Š', () => {
    document.getElementById('inputText').value = 'a\tb\tc\n1\t2\t3';
    document.getElementById('column-delimiter-text').value = '\\t';
    document.getElementById('column-count').value = '3';
    executeColumnExtractMulti();
    const col2 = document.getElementById('col-output-1').value;
    return col2 === 'b\n2';
  });
  
  test('åˆ—æŠ½å‡º - ãƒˆãƒªãƒ ON', () => {
    document.getElementById('inputText').value = '  a  ,  b  ,c';
    document.getElementById('column-delimiter-text').value = ',';
    document.getElementById('column-count').value = '3';
    document.getElementById('column-trim').checked = true;
    executeColumnExtractMulti();
    const col1 = document.getElementById('col-output-0').value;
    document.getElementById('column-trim').checked = false;
    return col1 === 'a';
  });
  
  test('åˆ—æŠ½å‡º - ç©ºè¡Œå‰Šé™¤', () => {
    document.getElementById('inputText').value = 'a,b\n\nc,d';
    document.getElementById('column-delimiter-text').value = ',';
    document.getElementById('column-count').value = '2';
    document.getElementById('column-remove-empty').checked = true;
    executeColumnExtractMulti();
    const col1 = document.getElementById('col-output-0').value;
    document.getElementById('column-remove-empty').checked = false;
    return col1 === 'a\nc';
  });
  
  // 5. æ¤œç´¢ã¨ç½®æ›
  test('æ¤œç´¢ã¨ç½®æ› - å˜ç´”ç½®æ›', () => {
    document.getElementById('find-text').value = 'cat';
    document.getElementById('replace-text').value = 'dog';
    document.getElementById('find-regex').checked = false;
    document.getElementById('find-case').checked = false;
    const result = executeFindReplace('I have a cat');
    return result === 'I have a dog';
  });
  
  test('æ¤œç´¢ã¨ç½®æ› - å¤§æ–‡å­—å°æ–‡å­—åŒºåˆ¥ON', () => {
    document.getElementById('find-text').value = 'Cat';
    document.getElementById('replace-text').value = 'dog';
    document.getElementById('find-regex').checked = false;
    document.getElementById('find-case').checked = true;
    const result = executeFindReplace('cat Cat CAT');
    return result === 'cat dog CAT';
  });
  
  test('æ¤œç´¢ã¨ç½®æ› - å¤§æ–‡å­—å°æ–‡å­—åŒºåˆ¥OFF', () => {
    document.getElementById('find-text').value = 'cat';
    document.getElementById('replace-text').value = 'dog';
    document.getElementById('find-regex').checked = false;
    document.getElementById('find-case').checked = false;
    const result = executeFindReplace('cat Cat CAT');
    return result === 'dog dog dog';
  });
  
  test('æ¤œç´¢ã¨ç½®æ› - æ­£è¦è¡¨ç¾', () => {
    document.getElementById('find-text').value = '\\d+';
    document.getElementById('replace-text').value = 'X';
    document.getElementById('find-regex').checked = true;
    const result = executeFindReplace('abc123def456');
    return result === 'abcXdefX';
  });
  
  test('æ¤œç´¢ã¨ç½®æ› - æ­£è¦è¡¨ç¾ã‚°ãƒ«ãƒ¼ãƒ—', () => {
    document.getElementById('find-text').value = '(\\w+)@(\\w+)';
    document.getElementById('replace-text').value = '$2:$1';
    document.getElementById('find-regex').checked = true;
    const result = executeFindReplace('user@domain');
    return result === 'domain:user';
  });
  
  // 6. è¡Œçµåˆï¼ˆè¡Œæ“ä½œã«çµ±åˆï¼‰
  test('è¡Œæ“ä½œ - è¡Œçµåˆ - ã‚«ãƒ³ãƒã§çµåˆ', () => {
    document.getElementById('combine-delimiter').value = ',';
    document.getElementById('combine-skip-empty').checked = true;
    document.getElementById('inputText').value = 'a\nb\nc';
    executeLineOps('combine');
    return document.getElementById('outputText').value === 'a,b,c';
  });
  
  test('è¡Œæ“ä½œ - è¡Œçµåˆ - ç©ºæ¬„ã§ç›´æ¥çµåˆ', () => {
    document.getElementById('combine-delimiter').value = '';
    document.getElementById('combine-skip-empty').checked = true;
    document.getElementById('inputText').value = 'a\nb\nc';
    executeLineOps('combine');
    return document.getElementById('outputText').value === 'abc';
  });
  
  test('è¡Œæ“ä½œ - è¡Œçµåˆ - ç©ºè¡Œã‚¹ã‚­ãƒƒãƒ—ON', () => {
    document.getElementById('combine-delimiter').value = '-';
    document.getElementById('combine-skip-empty').checked = true;
    document.getElementById('inputText').value = 'a\n\nb';
    executeLineOps('combine');
    return document.getElementById('outputText').value === 'a-b';
  });
  
  test('è¡Œæ“ä½œ - è¡Œçµåˆ - ç©ºè¡Œã‚¹ã‚­ãƒƒãƒ—OFF', () => {
    document.getElementById('combine-delimiter').value = '-';
    document.getElementById('combine-skip-empty').checked = false;
    document.getElementById('inputText').value = 'a\n\nb';
    executeLineOps('combine');
    return document.getElementById('outputText').value === 'a--b';
  });
  
  // 7. çµ„ã¿åˆã‚ã›ç”Ÿæˆ
  test('çµ„ã¿åˆã‚ã›ç”Ÿæˆ - 2ãƒªã‚¹ãƒˆ', () => {
    document.getElementById('combo-list-0').value = 'A\nB';
    document.getElementById('combo-list-1').value = '1\n2';
    document.getElementById('combo-list-2').value = '';
    document.getElementById('combo-delim-0').value = '';
    document.getElementById('combo-delim-1').value = '';
    document.getElementById('combo-prefix').value = '';
    document.getElementById('combo-suffix').value = '';
    const result = executeCombination('');
    return result === 'A1\nA2\nB1\nB2';
  });
  
  test('çµ„ã¿åˆã‚ã›ç”Ÿæˆ - 3ãƒªã‚¹ãƒˆ', () => {
    document.getElementById('combo-list-0').value = 'A';
    document.getElementById('combo-list-1').value = '1';
    document.getElementById('combo-list-2').value = 'X\nY';
    document.getElementById('combo-delim-0').value = '';
    document.getElementById('combo-delim-1').value = '';
    document.getElementById('combo-prefix').value = '';
    document.getElementById('combo-suffix').value = '';
    const result = executeCombination('');
    return result === 'A1X\nA1Y';
  });
  
  test('çµ„ã¿åˆã‚ã›ç”Ÿæˆ - åŒºåˆ‡ã‚Šä»˜ã', () => {
    document.getElementById('combo-list-0').value = 'X\nY';
    document.getElementById('combo-list-1').value = '1';
    document.getElementById('combo-list-2').value = '';
    document.getElementById('combo-delim-0').value = '-';
    document.getElementById('combo-prefix').value = '[';
    document.getElementById('combo-suffix').value = ']';
    const result = executeCombination('');
    return result === '[X-1]\n[Y-1]';
  });
  
  // 8. é‡è¤‡è¡Œå‰Šé™¤ï¼ˆè¡Œæ“ä½œã«çµ±åˆï¼‰
  test('è¡Œæ“ä½œ - é‡è¤‡è¡Œå‰Šé™¤ - åŸºæœ¬', () => {
    document.getElementById('dup-case').checked = false;
    document.getElementById('dup-trim').checked = false;
    document.getElementById('dup-keep-order').checked = true;
    document.getElementById('inputText').value = 'a\nb\na\nc\nb';
    executeLineOps('removeDuplicates');
    return document.getElementById('outputText').value === 'a\nb\nc';
  });
  
  test('è¡Œæ“ä½œ - é‡è¤‡è¡Œå‰Šé™¤ - å¤§æ–‡å­—å°æ–‡å­—åŒºåˆ¥ON', () => {
    document.getElementById('dup-case').checked = true;
    document.getElementById('dup-trim').checked = false;
    document.getElementById('dup-keep-order').checked = true;
    document.getElementById('inputText').value = 'A\na\nA';
    executeLineOps('removeDuplicates');
    return document.getElementById('outputText').value === 'A\na';
  });
  
  test('è¡Œæ“ä½œ - é‡è¤‡è¡Œå‰Šé™¤ - å¤§æ–‡å­—å°æ–‡å­—åŒºåˆ¥OFF', () => {
    document.getElementById('dup-case').checked = false;
    document.getElementById('dup-trim').checked = false;
    document.getElementById('dup-keep-order').checked = true;
    document.getElementById('inputText').value = 'A\na\nA';
    executeLineOps('removeDuplicates');
    return document.getElementById('outputText').value === 'A';
  });
  
  test('è¡Œæ“ä½œ - é‡è¤‡è¡Œå‰Šé™¤ - å‰å¾Œã®ç©ºç™½ã‚’ç„¡è¦–ON', () => {
    document.getElementById('dup-case').checked = true;
    document.getElementById('dup-trim').checked = true;
    document.getElementById('dup-keep-order').checked = true;
    document.getElementById('inputText').value = 'a\n a \na';
    executeLineOps('removeDuplicates');
    return document.getElementById('outputText').value === 'a';
  });
  
  test('è¡Œæ“ä½œ - é‡è¤‡è¡Œå‰Šé™¤ - å‡ºç¾é †åºã‚’ä¿æŒOFF', () => {
    document.getElementById('dup-case').checked = true;
    document.getElementById('dup-trim').checked = false;
    document.getElementById('dup-keep-order').checked = false;
    document.getElementById('inputText').value = 'c\na\nb\na';
    executeLineOps('removeDuplicates');
    return document.getElementById('outputText').value === 'a\nb\nc';
  });
  
  // 9. ç©ºè¡Œå‰Šé™¤ï¼ˆè¡Œæ“ä½œã«çµ±åˆï¼‰
  test('è¡Œæ“ä½œ - ç©ºè¡Œå‰Šé™¤ - å®Œå…¨ãªç©ºè¡Œã®ã¿', () => {
    document.getElementById('empty-whitespace').checked = false;
    document.getElementById('inputText').value = 'a\n\nb\n   \nc';
    executeLineOps('removeEmpty');
    return document.getElementById('outputText').value === 'a\nb\n   \nc';
  });
  
  test('è¡Œæ“ä½œ - ç©ºè¡Œå‰Šé™¤ - ç©ºç™½ã®ã¿ã®è¡Œã‚‚å‰Šé™¤', () => {
    document.getElementById('empty-whitespace').checked = true;
    document.getElementById('inputText').value = 'a\n   \nb';
    executeLineOps('removeEmpty');
    return document.getElementById('outputText').value === 'a\nb';
  });
  
  // 10. ç©ºç™½å‰Šé™¤
  test('ç©ºç™½å‰Šé™¤ - ãƒˆãƒªãƒ ã®ã¿', () => {
    document.getElementById('spaces-trim').checked = true;
    document.querySelector('input[name="spaces-remove-mode"][value="none"]').checked = true;
    const result = executeRemoveSpaces('  hello  \n  world  ');
    return result === 'hello\nworld';
  });
  
  test('ç©ºç™½å‰Šé™¤ - é€£ç¶šç©ºç™½ã‚’1ã¤ã«', () => {
    document.getElementById('spaces-trim').checked = false;
    document.querySelector('input[name="spaces-remove-mode"][value="extra"]').checked = true;
    const result = executeRemoveSpaces('a   b    c');
    return result === 'a b c';
  });
  
  test('ç©ºç™½å‰Šé™¤ - ã™ã¹ã¦å‰Šé™¤', () => {
    document.getElementById('spaces-trim').checked = false;
    document.querySelector('input[name="spaces-remove-mode"][value="all"]').checked = true;
    const result = executeRemoveSpaces('a b c');
    return result === 'abc';
  });
  
  test('ç©ºç™½å‰Šé™¤ - ãƒˆãƒªãƒ +é€£ç¶šç©ºç™½ã‚’1ã¤ã«', () => {
    document.getElementById('spaces-trim').checked = true;
    document.querySelector('input[name="spaces-remove-mode"][value="extra"]').checked = true;
    const result = executeRemoveSpaces('  a   b  ');
    return result === 'a b';
  });
  
  // 11. ç©ºç™½è¿½åŠ 
  test('ç©ºç™½è¿½åŠ  - Næ–‡å­—ã”ã¨', () => {
    document.getElementById('spaces-add-every-n').checked = true;
    document.getElementById('spaces-add-n').value = '3';
    document.getElementById('spaces-add-after-char').checked = false;
    document.getElementById('spaces-add-after-line').checked = false;
    const result = executeAddSpacesMain('abcdefghi');
    return result === 'abc def ghi';
  });
  
  test('ç©ºç™½è¿½åŠ  - æŒ‡å®šæ–‡å­—ã®å¾Œ', () => {
    document.getElementById('spaces-add-every-n').checked = false;
    document.getElementById('spaces-add-after-char').checked = true;
    document.getElementById('spaces-after-char').value = '.';
    document.getElementById('spaces-add-after-line').checked = false;
    const result = executeAddSpacesMain('a.b.c');
    return result === 'a. b. c';
  });
  
  test('ç©ºç™½è¿½åŠ  - å„è¡Œæœ«å°¾', () => {
    document.getElementById('spaces-add-every-n').checked = false;
    document.getElementById('spaces-add-after-char').checked = false;
    document.getElementById('spaces-add-after-line').checked = true;
    const result = executeAddSpacesMain('a\nb');
    return result === 'a \nb ';
  });
  
  test('ç©ºç™½è¿½åŠ  - è¤‡åˆï¼ˆNæ–‡å­—ã”ã¨+è¡Œæœ«å°¾ï¼‰', () => {
    document.getElementById('spaces-add-every-n').checked = true;
    document.getElementById('spaces-add-n').value = '2';
    document.getElementById('spaces-add-after-char').checked = false;
    document.getElementById('spaces-add-after-line').checked = true;
    const result = executeAddSpacesMain('abcd');
    return result === 'ab cd ';
  });
  
  // 12. æ–‡å­—å¤‰æ›
  test('æ–‡å­—å¤‰æ› - å°æ–‡å­—ã«å¤‰æ›', () => {
    document.getElementById('inputText').value = 'HELLO World';
    executeConvert('lowercase');
    return document.getElementById('outputText').value === 'hello world';
  });
  
  test('æ–‡å­—å¤‰æ› - å¤§æ–‡å­—ã«å¤‰æ›', () => {
    document.getElementById('inputText').value = 'Hello World';
    executeConvert('uppercase');
    return document.getElementById('outputText').value === 'HELLO WORLD';
  });
  
  test('æ–‡å­—å¤‰æ› - å„å˜èªã®å…ˆé ­ã‚’å¤§æ–‡å­—', () => {
    document.getElementById('inputText').value = 'hello world test';
    executeConvert('capitalizeWords');
    return document.getElementById('outputText').value === 'Hello World Test';
  });
  
  test('æ–‡å­—å¤‰æ› - å„å˜èªã®å…ˆé ­ã‚’å°æ–‡å­—', () => {
    document.getElementById('inputText').value = 'Hello World Test';
    executeConvert('uncapitalizeWords');
    return document.getElementById('outputText').value === 'hello world test';
  });
  
  test('æ–‡å­—å¤‰æ› - å„æ–‡ã®å…ˆé ­ã‚’å¤§æ–‡å­—', () => {
    document.getElementById('inputText').value = 'hello. world. test';
    executeConvert('capitalizeSentences');
    return document.getElementById('outputText').value === 'Hello. World. Test';
  });
  
  test('æ–‡å­—å¤‰æ› - snake_case', () => {
    document.getElementById('inputText').value = 'Hello World Test';
    executeConvert('snakeCase');
    return document.getElementById('outputText').value === 'hello_world_test';
  });
  
  test('æ–‡å­—å¤‰æ› - kebab-case', () => {
    document.getElementById('inputText').value = 'Hello World Test';
    executeConvert('kebabCase');
    return document.getElementById('outputText').value === 'hello-world-test';
  });
  
  test('æ–‡å­—å¤‰æ› - camelCase', () => {
    document.getElementById('inputText').value = 'hello world test';
    executeConvert('camelCase');
    return document.getElementById('outputText').value === 'helloWorldTest';
  });
  
  test('æ–‡å­—å¤‰æ› - PascalCase', () => {
    document.getElementById('inputText').value = 'hello world test';
    executeConvert('pascalCase');
    return document.getElementById('outputText').value === 'HelloWorldTest';
  });
  
  test('æ–‡å­—å¤‰æ› - ã²ã‚‰ãŒãªâ†’ã‚«ã‚¿ã‚«ãƒŠ', () => {
    document.getElementById('inputText').value = 'ã‚ã„ã†ãˆãŠ';
    executeConvert('hiraToKata');
    return document.getElementById('outputText').value === 'ã‚¢ã‚¤ã‚¦ã‚¨ã‚ª';
  });
  
  test('æ–‡å­—å¤‰æ› - ã‚«ã‚¿ã‚«ãƒŠâ†’ã²ã‚‰ãŒãª', () => {
    document.getElementById('inputText').value = 'ã‚¢ã‚¤ã‚¦ã‚¨ã‚ª';
    executeConvert('kataToHira');
    return document.getElementById('outputText').value === 'ã‚ã„ã†ãˆãŠ';
  });
  
  test('æ–‡å­—å¤‰æ› - å…¨è§’è‹±æ•°â†’åŠè§’è‹±æ•°', () => {
    document.getElementById('inputText').value = 'ï¼¡ï¼¢ï¼£ï¼‘ï¼’ï¼“';
    executeConvert('alphaToFull');
    return document.getElementById('outputText').value === 'ABC123';
  });
  
  test('æ–‡å­—å¤‰æ› - åŠè§’è‹±æ•°â†’å…¨è§’è‹±æ•°', () => {
    document.getElementById('inputText').value = 'ABC123';
    executeConvert('alphaToHalf');
    return document.getElementById('outputText').value === 'ï¼¡ï¼¢ï¼£ï¼‘ï¼’ï¼“';
  });
  
  test('æ–‡å­—å¤‰æ› - å…¨è§’ã‚«ã‚¿ã‚«ãƒŠâ†’åŠè§’ã‚«ã‚¿ã‚«ãƒŠ', () => {
    document.getElementById('inputText').value = 'ã‚¢ã‚¤ã‚¦';
    executeConvert('kataToFull');
    return document.getElementById('outputText').value === 'ï½±ï½²ï½³';
  });
  
  test('æ–‡å­—å¤‰æ› - åŠè§’ã‚«ã‚¿ã‚«ãƒŠâ†’å…¨è§’ã‚«ã‚¿ã‚«ãƒŠ', () => {
    document.getElementById('inputText').value = 'ï½±ï½²ï½³';
    executeConvert('kataToHalf');
    return document.getElementById('outputText').value === 'ã‚¢ã‚¤ã‚¦';
  });
  
  test('æ–‡å­—å¤‰æ› - å…¨è§’â†’åŠè§’ï¼ˆæ··åœ¨ï¼‰', () => {
    document.getElementById('inputText').value = 'ï¼¡ï½‚ï½ƒï¼‘ï¼’ï¼“';
    executeConvert('toFullwidth');
    return document.getElementById('outputText').value === 'Abc123';
  });
  
  test('æ–‡å­—å¤‰æ› - åŠè§’â†’å…¨è§’ï¼ˆæ··åœ¨ï¼‰', () => {
    document.getElementById('inputText').value = 'Abc123';
    executeConvert('toHalfwidth');
    return document.getElementById('outputText').value === 'ï¼¡ï½‚ï½ƒï¼‘ï¼’ï¼“';
  });
  
  test('æ–‡å­—å¤‰æ› - TABâ†’ç©ºç™½', () => {
    document.getElementById('inputText').value = 'a\tb';
    document.getElementById('convert-tab-spaces').value = '4';
    executeConvert('tabToSpace');
    return document.getElementById('outputText').value === 'a    b';
  });
  
  test('æ–‡å­—å¤‰æ› - ç©ºç™½â†’TAB', () => {
    document.getElementById('inputText').value = 'a    b';
    document.getElementById('convert-tab-spaces').value = '4';
    executeConvert('spaceToTab');
    return document.getElementById('outputText').value === 'a\tb';
  });
  
  test('æ–‡å­—å¤‰æ› - TABâ†’ç©ºç™½ï¼ˆã‚¹ãƒšãƒ¼ã‚¹æ•°å¤‰æ›´ï¼‰', () => {
    document.getElementById('inputText').value = 'a\tb';
    document.getElementById('convert-tab-spaces').value = '2';
    executeConvert('tabToSpace');
    return document.getElementById('outputText').value === 'a  b';
  });
  
  // 13. è¡Œæ“ä½œ
  test('è¡Œæ“ä½œ - å·¦ã®ç©ºç™½ã‚’å‰Šé™¤', () => {
    document.getElementById('inputText').value = '  hello\n  world';
    executeLineOps('trimLeft');
    return document.getElementById('outputText').value === 'hello\nworld';
  });
  
  test('è¡Œæ“ä½œ - å³ã®ç©ºç™½ã‚’å‰Šé™¤', () => {
    document.getElementById('inputText').value = 'hello  \nworld  ';
    executeLineOps('trimRight');
    return document.getElementById('outputText').value === 'hello\nworld';
  });
  
  test('è¡Œæ“ä½œ - å·¦ã®ç©ºç™½ã‚’å‰Šé™¤ï¼ˆå…¨è§’ç©ºç™½ï¼‰', () => {
    document.getElementById('inputText').value = 'ã€€ã€€hello';
    executeLineOps('trimLeft');
    return document.getElementById('outputText').value === 'hello';
  });
  
  test('è¡Œæ“ä½œ - å³ã®ç©ºç™½ã‚’å‰Šé™¤ï¼ˆå…¨è§’ç©ºç™½ï¼‰', () => {
    document.getElementById('inputText').value = 'helloã€€ã€€';
    executeLineOps('trimRight');
    return document.getElementById('outputText').value === 'hello';
  });
  
  test('è¡Œæ“ä½œ - ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ã‚½ãƒ¼ãƒˆ', () => {
    document.getElementById('sort-delimiter').value = '';
    document.getElementById('sort-desc').checked = false;
    document.getElementById('inputText').value = 'c\na\nb';
    executeLineOps('sortAlpha');
    return document.getElementById('outputText').value === 'a\nb\nc';
  });
  
  test('è¡Œæ“ä½œ - ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ã‚½ãƒ¼ãƒˆï¼ˆé™é †ï¼‰', () => {
    document.getElementById('sort-delimiter').value = '';
    document.getElementById('sort-desc').checked = true;
    document.getElementById('inputText').value = 'a\nc\nb';
    executeLineOps('sortAlpha');
    document.getElementById('sort-desc').checked = false;
    return document.getElementById('outputText').value === 'c\nb\na';
  });
  
  test('è¡Œæ“ä½œ - ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ã‚½ãƒ¼ãƒˆï¼ˆå¤§æ–‡å­—å°æ–‡å­—åŒºåˆ¥ãªã—ï¼‰', () => {
    document.getElementById('sort-delimiter').value = '';
    document.getElementById('sort-desc').checked = false;
    document.getElementById('inputText').value = 'B\na\nC';
    executeLineOps('sortAlpha');
    const result = document.getElementById('outputText').value;
    return result === 'a\nB\nC' || result === 'a\nC\nB'; // å¤§æ–‡å­—å°æ–‡å­—åŒºåˆ¥ãªã—ãªã®ã§aãŒå…ˆé ­
  });
  
  test('è¡Œæ“ä½œ - ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ã‚½ãƒ¼ãƒˆï¼ˆå¤§æ–‡å­—å°æ–‡å­—åŒºåˆ¥ã‚ã‚Šï¼‰', () => {
    document.getElementById('sort-delimiter').value = '';
    document.getElementById('sort-desc').checked = false;
    document.getElementById('inputText').value = 'b\nA\nB\na';
    executeLineOps('sortAlphaCase');
    // ASCIIé †: A(65), B(66), a(97), b(98)
    return document.getElementById('outputText').value === 'A\nB\na\nb';
  });
  
  test('è¡Œæ“ä½œ - è‡ªç„¶é †ã‚½ãƒ¼ãƒˆï¼ˆæ•°å€¤å¯¾å¿œï¼‰', () => {
    document.getElementById('sort-delimiter').value = '';
    document.getElementById('sort-desc').checked = false;
    document.getElementById('inputText').value = '1\n10\n2\n15\n3';
    executeLineOps('sortNatural');
    return document.getElementById('outputText').value === '1\n2\n3\n10\n15';
  });
  
  test('è¡Œæ“ä½œ - è‡ªç„¶é †ã‚½ãƒ¼ãƒˆï¼ˆãƒ•ã‚¡ã‚¤ãƒ«åï¼‰', () => {
    document.getElementById('sort-delimiter').value = '';
    document.getElementById('sort-desc').checked = false;
    document.getElementById('inputText').value = 'file10.txt\nfile2.txt\nfile1.txt';
    executeLineOps('sortNatural');
    return document.getElementById('outputText').value === 'file1.txt\nfile2.txt\nfile10.txt';
  });
  
  test('è¡Œæ“ä½œ - è‡ªç„¶é †ã‚½ãƒ¼ãƒˆï¼ˆå¤§æ–‡å­—å°æ–‡å­—åŒºåˆ¥ã‚ã‚Šï¼‰', () => {
    document.getElementById('sort-delimiter').value = '';
    document.getElementById('sort-desc').checked = false;
    document.getElementById('inputText').value = 'B2\na1\nA10';
    executeLineOps('sortNaturalCase');
    // ASCIIé † + æ•°å€¤é †: A10, B2, a1
    return document.getElementById('outputText').value === 'A10\nB2\na1';
  });
  
  test('è¡Œæ“ä½œ - æ–‡å­—æ•°é †ã‚½ãƒ¼ãƒˆ', () => {
    document.getElementById('sort-delimiter').value = '';
    document.getElementById('sort-desc').checked = false;
    document.getElementById('inputText').value = 'aaa\na\naa';
    executeLineOps('sortLength');
    return document.getElementById('outputText').value === 'a\naa\naaa';
  });
  
  test('è¡Œæ“ä½œ - æ–‡å­—æ•°é †ã‚½ãƒ¼ãƒˆï¼ˆé™é †ï¼‰', () => {
    document.getElementById('sort-delimiter').value = '';
    document.getElementById('sort-desc').checked = true;
    document.getElementById('inputText').value = 'a\naaa\naa';
    executeLineOps('sortLength');
    document.getElementById('sort-desc').checked = false;
    return document.getElementById('outputText').value === 'aaa\naa\na';
  });
  
  test('è¡Œæ“ä½œ - é€†é †', () => {
    document.getElementById('inputText').value = 'a\nb\nc';
    executeLineOps('sortReverse');
    return document.getElementById('outputText').value === 'c\nb\na';
  });
  
  test('è¡Œæ“ä½œ - ãƒ©ãƒ³ãƒ€ãƒ ã‚½ãƒ¼ãƒˆ', () => {
    document.getElementById('inputText').value = 'a\nb\nc\nd\ne';
    executeLineOps('sortRandom');
    const result = document.getElementById('outputText').value;
    // ãƒ©ãƒ³ãƒ€ãƒ ãªã®ã§ã€è¡Œæ•°ãŒåŒã˜ã§åŒã˜è¦ç´ ã‚’å«ã‚€ã“ã¨ã‚’ç¢ºèª
    const lines = result.split('\n').sort();
    return lines.join('\n') === 'a\nb\nc\nd\ne';
  });
  
  test('è¡Œæ“ä½œ - åŒºåˆ‡ã‚Šæ–‡å­—æŒ‡å®šã‚½ãƒ¼ãƒˆ', () => {
    document.getElementById('sort-delimiter').value = ',';
    document.getElementById('sort-column').value = '2';
    document.getElementById('sort-desc').checked = false;
    document.getElementById('inputText').value = 'x,3\ny,1\nz,2';
    executeLineOps('sortNatural');
    document.getElementById('sort-delimiter').value = '';
    document.getElementById('sort-column').value = '1';
    return document.getElementById('outputText').value === 'y,1\nz,2\nx,3';
  });
  
  test('è¡Œæ“ä½œ - åŒºåˆ‡ã‚Šæ–‡å­—æŒ‡å®šã‚½ãƒ¼ãƒˆï¼ˆ3åˆ—ç›®ï¼‰', () => {
    document.getElementById('sort-delimiter').value = '\t';
    document.getElementById('sort-column').value = '3';
    document.getElementById('sort-desc').checked = false;
    document.getElementById('inputText').value = 'a\t1\tc\nb\t2\ta\nc\t3\tb';
    executeLineOps('sortAlpha');
    document.getElementById('sort-delimiter').value = '';
    document.getElementById('sort-column').value = '1';
    return document.getElementById('outputText').value === 'b\t2\ta\nc\t3\tb\na\t1\tc';
  });
  
  test('è¡Œæ“ä½œ - æ—¥æœ¬èªã‚½ãƒ¼ãƒˆ', () => {
    document.getElementById('sort-delimiter').value = '';
    document.getElementById('sort-desc').checked = false;
    document.getElementById('inputText').value = 'ã‹\nã‚\nã•';
    executeLineOps('sortAlpha');
    return document.getElementById('outputText').value === 'ã‚\nã‹\nã•';
  });
  
  test('è¡Œæ“ä½œ - uniq (é€£ç¶šé‡è¤‡å‰Šé™¤)', () => {
    document.getElementById('inputText').value = 'a\na\nb\nb\na';
    executeLineOps('uniq');
    return document.getElementById('outputText').value === 'a\nb\na';
  });
  
  // 14. è¡Œãƒ•ã‚£ãƒ«ã‚¿
  test('è¡Œæ“ä½œ - å«ã‚€è¡Œã‚’å‰Šé™¤', () => {
    document.getElementById('inputText').value = 'apple\nbanana\napricot\ncherry';
    document.getElementById('filter-text').value = 'ap';
    document.getElementById('filter-case').checked = false;
    document.getElementById('filter-regex').checked = false;
    document.getElementById('filter-show-removed').checked = false;
    executeLineOps('filterContaining');
    return document.getElementById('outputText').value === 'banana\ncherry';
  });
  
  test('è¡Œæ“ä½œ - å«ã¾ãªã„è¡Œã‚’å‰Šé™¤', () => {
    document.getElementById('inputText').value = 'apple\nbanana\napricot\ncherry';
    document.getElementById('filter-text').value = 'ap';
    document.getElementById('filter-case').checked = false;
    document.getElementById('filter-regex').checked = false;
    document.getElementById('filter-show-removed').checked = false;
    executeLineOps('filterNotContaining');
    return document.getElementById('outputText').value === 'apple\napricot';
  });
  
  test('è¡Œæ“ä½œ - å«ã‚€è¡Œã‚’å‰Šé™¤ï¼ˆå¤§æ–‡å­—å°æ–‡å­—åŒºåˆ¥ï¼‰', () => {
    document.getElementById('inputText').value = 'Apple\napple\nAPPLE';
    document.getElementById('filter-text').value = 'Apple';
    document.getElementById('filter-case').checked = true;
    document.getElementById('filter-regex').checked = false;
    document.getElementById('filter-show-removed').checked = false;
    executeLineOps('filterContaining');
    document.getElementById('filter-case').checked = false;
    return document.getElementById('outputText').value === 'apple\nAPPLE';
  });
  
  test('è¡Œæ“ä½œ - æ­£è¦è¡¨ç¾ã§ãƒ•ã‚£ãƒ«ã‚¿', () => {
    document.getElementById('inputText').value = 'test1\ntest2\nhello\ntest10';
    document.getElementById('filter-text').value = '^test\\d+$';
    document.getElementById('filter-case').checked = false;
    document.getElementById('filter-regex').checked = true;
    document.getElementById('filter-show-removed').checked = false;
    executeLineOps('filterContaining');
    document.getElementById('filter-regex').checked = false;
    return document.getElementById('outputText').value === 'hello';
  });
  
  // 15. ç¹°ã‚Šè¿”ã—ç”Ÿæˆ
  test('è¡Œæ“ä½œ - ç¹°ã‚Šè¿”ã—ç”Ÿæˆï¼ˆåŸºæœ¬ï¼‰', () => {
    document.getElementById('inputText').value = 'abc';
    document.getElementById('repeat-count').value = '3';
    document.getElementById('repeat-per-row').value = '1';
    document.getElementById('repeat-separator').value = '';
    document.getElementById('repeat-each-line').checked = false;
    executeLineOps('repeat');
    return document.getElementById('outputText').value === 'abc\nabc\nabc';
  });
  
  test('è¡Œæ“ä½œ - ç¹°ã‚Šè¿”ã—ç”Ÿæˆï¼ˆ1è¡Œã«è¤‡æ•°ï¼‰', () => {
    document.getElementById('inputText').value = 'x';
    document.getElementById('repeat-count').value = '6';
    document.getElementById('repeat-per-row').value = '3';
    document.getElementById('repeat-separator').value = ',';
    document.getElementById('repeat-each-line').checked = false;
    executeLineOps('repeat');
    return document.getElementById('outputText').value === 'x,x,x\nx,x,x';
  });
  
  test('è¡Œæ“ä½œ - ç¹°ã‚Šè¿”ã—ç”Ÿæˆï¼ˆå„è¡Œå€‹åˆ¥ï¼‰', () => {
    document.getElementById('inputText').value = 'a\nb';
    document.getElementById('repeat-count').value = '2';
    document.getElementById('repeat-per-row').value = '1';
    document.getElementById('repeat-separator').value = '';
    document.getElementById('repeat-each-line').checked = true;
    executeLineOps('repeat');
    document.getElementById('repeat-each-line').checked = false;
    return document.getElementById('outputText').value === 'a\na\nb\nb';
  });
  
  // çµæœã‚µãƒãƒªãƒ¼
  console.log('========================================');
  console.log(`ãƒ†ã‚¹ãƒˆå®Œäº†: ${passed} æˆåŠŸ, ${failed} å¤±æ•—`);
  console.log('========================================');
  
  return { passed, failed };
}

// ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å…¬é–‹
window.runAllTests = runAllTests;
</script>
</body>
</html>
